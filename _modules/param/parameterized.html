
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>param.parameterized â€” param 1.11.1 documentation</title>
<link href="../../_static/css/theme.css" rel="stylesheet"/>
<link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet"/>
<link href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
<link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css">
<link href="../../_static/basic.css" rel="stylesheet" type="text/css">
<link href="../../_static/togglebutton.css" rel="stylesheet" type="text/css">
<link href="../../_static/mystnb.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/graphviz.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/site.css" rel="stylesheet" type="text/css"/>
<link as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js" rel="preload"/>
<script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
<script src="../../_static/jquery.js"></script>
<script src="../../_static/underscore.js"></script>
<script src="../../_static/doctools.js"></script>
<script src="../../_static/togglebutton.js"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
<link href="../../about.html" rel="author" title="About these documents">
<link href="../../genindex.html" rel="index" title="Index"/>
<link href="../../search.html" rel="search" title="Search"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="en" name="docsearch:language"/>
</link></link></link></link></head>
<body data-offset="80" data-spy="scroll" data-target="#bd-toc-nav">
<div class="container-fluid" id="banner"></div>
<nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">
<div id="navbar-start">
<a class="navbar-brand" href="../../index.html">
<img alt="logo" class="logo" src="../../_static/logo_horizontal.png"/>
</a>
</div>
<button aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbar-collapsible" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="col-lg-9 collapse navbar-collapse" id="navbar-collapsible">
<div class="mr-auto" id="navbar-center">
<div class="navbar-center-item">
<ul class="navbar-nav" id="navbar-main-elements">
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../index.html">
  Introduction
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../getting_started.html">
  Getting Started
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../user_guide/index.html">
  User Guide
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../comparisons.html">
  Comparisons
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../roadmap.html">
  Roadmap
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../reference.html">
  API
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference external nav-link" href="https://github.com/holoviz/param">
  Github Source
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../about.html">
  About
 </a>
</li>
</ul>
</div>
</div>
<div id="navbar-end">
<div class="navbar-end-item">
<ul aria-label="Icon Links" class="navbar-nav" id="navbar-icon-links">
<li class="nav-item">
<a class="nav-link" href="https://github.com/holoviz/param" rel="noopener" target="_blank" title="GitHub">
<span><i class="fab fa-github-square"></i></span>
<label class="sr-only">GitHub</label>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://discourse.holoviz.org/" rel="noopener" target="_blank" title="Discourse">
<span><i class="fab fa-discourse"></i></span>
<label class="sr-only">Discourse</label>
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</nav>
<div class="container-xl">
<div class="row">
<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="col-12 col-md-3 bd-sidebar"><form action="../../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="icon fas fa-search"></i>
<input aria-label="Search the docs ..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search the docs ..." type="search"/>
</form><nav aria-label="Main navigation" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item active">
</div>
</nav>
</div>
<div class="d-none d-xl-block col-xl-2 bd-toc">
</div>
<main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
<div>
<h1>Source code for param.parameterized</h1><div class="highlight"><pre>
<span></span><span class="sd">"""</span>
<span class="sd">Generic support for objects with full-featured Parameters and</span>
<span class="sd">messaging.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numbers</span>
<span class="kn">import</span> <span class="nn">operator</span>

<span class="c1"># Allow this file to be used standalone if desired, albeit without JSON serialization</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">serializer</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">serializer</span> <span class="o">=</span> <span class="kc">None</span>


<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">namedtuple</span><span class="p">,</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span><span class="p">,</span> <span class="n">wraps</span><span class="p">,</span> <span class="n">reduce</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span><span class="p">,</span><span class="n">attrgetter</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">FunctionType</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">DEBUG</span><span class="p">,</span> <span class="n">INFO</span><span class="p">,</span> <span class="n">WARNING</span><span class="p">,</span> <span class="n">ERROR</span><span class="p">,</span> <span class="n">CRITICAL</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># In case the optional ipython module is unavailable</span>
    <span class="kn">from</span> <span class="nn">.ipython</span> <span class="kn">import</span> <span class="n">ParamPager</span>
    <span class="n">param_pager</span> <span class="o">=</span> <span class="n">ParamPager</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Generates param description</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">param_pager</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">basestring</span> <span class="o">=</span> <span class="n">basestring</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span> <span class="k">else</span> <span class="nb">str</span> <span class="c1"># noqa: it is defined</span>

<span class="n">VERBOSE</span> <span class="o">=</span> <span class="n">INFO</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">logging</span><span class="o">.</span><span class="n">addLevelName</span><span class="p">(</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="s2">"VERBOSE"</span><span class="p">)</span>

<span class="c1"># Get the appropriate logging.Logger instance. If `logger` is None, a</span>
<span class="c1"># logger named `"param"` will be instantiated. If `name` is set, a descendant</span>
<span class="c1"># logger with the name ``"param.&lt;name&gt;"`` is returned (or</span>
<span class="c1"># ``logger.name + ".&lt;name&gt;"``)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">'param'</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">root_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
            <span class="n">root_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
                <span class="n">fmt</span><span class="o">=</span><span class="s1">'</span><span class="si">%(levelname)s</span><span class="s1">:</span><span class="si">%(name)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">'</span><span class="p">)</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
            <span class="n">root_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">root_logger</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">root_logger</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">'.'</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>


<span class="c1"># Indicates whether warnings should be raised as errors, stopping</span>
<span class="c1"># processing.</span>
<span class="n">warnings_as_exceptions</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">docstring_signature</span> <span class="o">=</span> <span class="kc">True</span>        <span class="c1"># Add signature to class docstrings</span>
<span class="n">docstring_describe_params</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Add parameter description to class</span>
                                  <span class="c1"># docstrings (requires ipython module)</span>
<span class="n">object_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">warning_count</span> <span class="o">=</span> <span class="mi">0</span>


<div class="viewcode-block" id="logging_level"><a class="viewcode-back" href="../../reference.html#param.__init__.logging_level">[docs]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">logging_level</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Temporarily modify param's logging level.</span>
<span class="sd">    """</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">INFO</span><span class="p">,</span> <span class="n">WARNING</span><span class="p">,</span> <span class="n">ERROR</span><span class="p">,</span> <span class="n">CRITICAL</span><span class="p">,</span> <span class="n">VERBOSE</span><span class="p">]</span>
    <span class="n">level_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'DEBUG'</span><span class="p">,</span> <span class="s1">'INFO'</span><span class="p">,</span> <span class="s1">'WARNING'</span><span class="p">,</span> <span class="s1">'ERROR'</span><span class="p">,</span> <span class="s1">'CRITICAL'</span><span class="p">,</span> <span class="s1">'VERBOSE'</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">level_names</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Level </span><span class="si">%r</span><span class="s2"> not in </span><span class="si">%r</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">levels</span><span class="p">))</span>

    <span class="n">param_logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">()</span>
    <span class="n">logging_level</span> <span class="o">=</span> <span class="n">param_logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">()</span>
    <span class="n">param_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="n">level_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">level</span><span class="p">)])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="kc">None</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">param_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging_level</span><span class="p">)</span></div>


<div class="viewcode-block" id="batch_watch"><a class="viewcode-back" href="../../reference.html#param.__init__.batch_watch">[docs]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">batch_watch</span><span class="p">(</span><span class="n">parameterized</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Context manager to batch watcher events on a parameterized object.</span>
<span class="sd">    The context manager will queue any events triggered by setting a</span>
<span class="sd">    parameter on the supplied parameterized object and dispatch them</span>
<span class="sd">    all at once when the context manager exits. If run=False the</span>
<span class="sd">    queued events are not dispatched and should be processed manually.</span>
<span class="sd">    """</span>
    <span class="n">BATCH_WATCH</span> <span class="o">=</span> <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span>
    <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="n">enable</span> <span class="ow">or</span> <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="n">BATCH_WATCH</span>
        <span class="k">if</span> <span class="n">run</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">BATCH_WATCH</span><span class="p">:</span>
            <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_batch_call_watchers</span><span class="p">()</span></div>


<div class="viewcode-block" id="edit_constant"><a class="viewcode-back" href="../../reference.html#param.__init__.edit_constant">[docs]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">edit_constant</span><span class="p">(</span><span class="n">parameterized</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Temporarily set parameters on Parameterized object to constant=False</span>
<span class="sd">    to allow editing them.</span>
<span class="sd">    """</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">'existing'</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="n">constants</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">constant</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">const</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">constants</span><span class="p">):</span>
            <span class="n">p</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="n">const</span></div>


<div class="viewcode-block" id="discard_events"><a class="viewcode-back" href="../../reference.html#param.__init__.discard_events">[docs]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">discard_events</span><span class="p">(</span><span class="n">parameterized</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Context manager that discards any events within its scope</span>
<span class="sd">    triggered on the supplied parameterized object.</span>
<span class="sd">    """</span>
    <span class="n">batch_watch</span> <span class="o">=</span> <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span>
    <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">watchers</span><span class="p">,</span> <span class="n">events</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_watchers</span><span class="p">),</span>
                        <span class="nb">list</span><span class="p">(</span><span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_events</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="n">batch_watch</span>
        <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_watchers</span> <span class="o">=</span> <span class="n">watchers</span>
        <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_events</span> <span class="o">=</span> <span class="n">events</span></div>


<span class="c1"># External components can register an async executor which will run</span>
<span class="c1"># async functions</span>
<span class="n">async_executor</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="classlist"><a class="viewcode-back" href="../../reference.html#param.__init__.classlist">[docs]</a><span class="k">def</span> <span class="nf">classlist</span><span class="p">(</span><span class="n">class_</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Return a list of the class hierarchy above (and including) the given class.</span>

<span class="sd">    Same as inspect.getmro(class_)[::-1]</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="n">class_</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="descendents"><a class="viewcode-back" href="../../reference.html#param.__init__.descendents">[docs]</a><span class="k">def</span> <span class="nf">descendents</span><span class="p">(</span><span class="n">class_</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Return a list of the class hierarchy below (and including) the given class.</span>

<span class="sd">    The list is ordered from least- to most-specific.  Can be useful for</span>
<span class="sd">    printing the contents of an entire class hierarchy.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">class_</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_</span><span class="p">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">q</span> <span class="ow">and</span> <span class="n">b</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_all_slots"><a class="viewcode-back" href="../../reference.html#param.__init__.get_all_slots">[docs]</a><span class="k">def</span> <span class="nf">get_all_slots</span><span class="p">(</span><span class="n">class_</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Return a list of slot names for slots defined in class_ and its</span>
<span class="sd">    superclasses.</span>
<span class="sd">    """</span>
    <span class="c1"># A subclass's __slots__ attribute does not contain slots defined</span>
    <span class="c1"># in its superclass (the superclass' __slots__ end up as</span>
    <span class="c1"># attributes of the subclass).</span>
    <span class="n">all_slots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">parent_param_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classlist</span><span class="p">(</span><span class="n">class_</span><span class="p">)[</span><span class="mi">1</span><span class="p">::]]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">parent_param_classes</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="s1">'__slots__'</span><span class="p">):</span>
            <span class="n">all_slots</span><span class="o">+=</span><span class="n">c</span><span class="o">.</span><span class="vm">__slots__</span>
    <span class="k">return</span> <span class="n">all_slots</span></div>


<div class="viewcode-block" id="get_occupied_slots"><a class="viewcode-back" href="../../reference.html#param.__init__.get_occupied_slots">[docs]</a><span class="k">def</span> <span class="nf">get_occupied_slots</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Return a list of slots for which values have been set.</span>

<span class="sd">    (While a slot might be defined, if a value for that slot hasn't</span>
<span class="sd">    been set, then it's an AttributeError to request the slot's</span>
<span class="sd">    value.)</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">slot</span> <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">get_all_slots</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="n">slot</span><span class="p">)]</span></div>


<div class="viewcode-block" id="all_equal"><a class="viewcode-back" href="../../reference.html#param.__init__.all_equal">[docs]</a><span class="k">def</span> <span class="nf">all_equal</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Return a single boolean for arg1==arg2, even for numpy arrays</span>
<span class="sd">    using element-wise comparison.</span>

<span class="sd">    Uses all(arg1==arg2) for sequences, and arg1==arg2 otherwise.</span>

<span class="sd">    If both objects have an '_infinitely_iterable' attribute, they are</span>
<span class="sd">    not be zipped together and are compared directly instead.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s1">'_infinitely_iterable'</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="p">[</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">]):</span>
        <span class="k">return</span> <span class="n">arg1</span><span class="o">==</span><span class="n">arg2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">a1</span> <span class="o">==</span> <span class="n">a2</span> <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arg1</span><span class="o">==</span><span class="n">arg2</span></div>



<span class="c1"># For Python 2 compatibility.</span>
<span class="c1">#</span>
<span class="c1"># The syntax to use a metaclass changed incompatibly between 2 and</span>
<span class="c1"># 3. The add_metaclass() class decorator below creates a class using a</span>
<span class="c1"># specified metaclass in a way that works on both 2 and 3. For 3, can</span>
<span class="c1"># remove this decorator and specify metaclasses in a simpler way</span>
<span class="c1"># (https://docs.python.org/3/reference/datamodel.html#customizing-class-creation)</span>
<span class="c1">#</span>
<span class="c1"># Code from six (https://bitbucket.org/gutworth/six; version 1.4.1).</span>
<div class="viewcode-block" id="add_metaclass"><a class="viewcode-back" href="../../reference.html#param.__init__.add_metaclass">[docs]</a><span class="k">def</span> <span class="nf">add_metaclass</span><span class="p">(</span><span class="n">metaclass</span><span class="p">):</span>
    <span class="sd">"""Class decorator for creating a class with a metaclass."""</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">orig_vars</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">orig_vars</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'__dict__'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">orig_vars</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'__weakref__'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">slots_var</span> <span class="ow">in</span> <span class="n">orig_vars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'__slots__'</span><span class="p">,</span> <span class="p">()):</span>
            <span class="n">orig_vars</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">slots_var</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metaclass</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">,</span> <span class="n">orig_vars</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span></div>


<div class="viewcode-block" id="bothmethod"><a class="viewcode-back" href="../../reference.html#param.__init__.bothmethod">[docs]</a><span class="k">class</span> <span class="nc">bothmethod</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> <span class="c1"># pylint: disable-msg=R0903</span>
    <span class="sd">"""</span>
<span class="sd">    'optional @classmethod'</span>

<span class="sd">    A decorator that allows a method to receive either the class</span>
<span class="sd">    object (if called on the class) or the instance object</span>
<span class="sd">    (if called on the instance) as its first argument.</span>

<span class="sd">    Code (but not documentation) copied from:</span>
<span class="sd">    http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/523033.</span>
<span class="sd">    """</span>
    <span class="c1"># pylint: disable-msg=R0903</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>

    <span class="c1"># i.e. this is also a non-data descriptor</span>
    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wraps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">type_</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wraps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">_getattrr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">_getattr</span><span class="p">,</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">+</span> <span class="n">attr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">))</span>


<span class="c1"># (thought I was going to have a few decorators following this pattern)</span>
<span class="k">def</span> <span class="nf">accept_arguments</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">actual_f</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">actual_f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_f</span>


<div class="viewcode-block" id="no_instance_params"><a class="viewcode-back" href="../../reference.html#param.__init__.no_instance_params">[docs]</a><span class="k">def</span> <span class="nf">no_instance_params</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Disables instance parameters on the class</span>
<span class="sd">    """</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">_disable_instance__params</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="bp">cls</span></div>


<div class="viewcode-block" id="iscoroutinefunction"><a class="viewcode-back" href="../../reference.html#param.__init__.iscoroutinefunction">[docs]</a><span class="k">def</span> <span class="nf">iscoroutinefunction</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Whether the function is an asynchronous coroutine function.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">inspect</span><span class="p">,</span> <span class="s1">'iscoroutinefunction'</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">function</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">instance_descriptor</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="c1"># If parameter has an instance Parameter delegate setting</span>
    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">instance_param</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">'_instance__params'</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instance_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">instance_param</span><span class="p">:</span>
            <span class="n">instance_param</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_f</span>


<div class="viewcode-block" id="get_method_owner"><a class="viewcode-back" href="../../reference.html#param.__init__.get_method_owner">[docs]</a><span class="k">def</span> <span class="nf">get_method_owner</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Gets the instance that owns the supplied method</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">partial</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">func</span>
    <span class="k">return</span> <span class="n">method</span><span class="o">.</span><span class="vm">__self__</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">method</span><span class="o">.</span><span class="n">im_self</span></div>


<div class="viewcode-block" id="depends"><a class="viewcode-back" href="../../reference.html#param.__init__.depends">[docs]</a><span class="nd">@accept_arguments</span>
<span class="k">def</span> <span class="nf">depends</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">dependencies</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Annotates a function or Parameterized method to express its</span>
<span class="sd">    dependencies.  The specified dependencies can be either be</span>
<span class="sd">    Parameter instances or if a method is supplied they can be</span>
<span class="sd">    defined as strings referring to Parameters of the class,</span>
<span class="sd">    or Parameters of subobjects (Parameterized objects that are</span>
<span class="sd">    values of this object's parameters).  Dependencies can either be</span>
<span class="sd">    on Parameter values, or on other metadata about the Parameter.</span>
<span class="sd">    """</span>

    <span class="c1"># python3 would allow kw-only args</span>
    <span class="c1"># (i.e. "func,*dependencies,watch=False" rather than **kw and the check below)</span>
    <span class="n">watch</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"watch"</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_depends</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="n">deps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dependencies</span><span class="p">)</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">string_specs</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">deps</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">string_specs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'The depends decorator only accepts string '</span>
                             <span class="s1">'types referencing a parameter or parameter '</span>
                             <span class="s1">'instances, found </span><span class="si">%s</span><span class="s1"> type instead.'</span> <span class="o">%</span>
                             <span class="nb">type</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">)</span> <span class="ow">or</span>
                  <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="n">ParameterizedMetaclass</span><span class="p">))):</span>
            <span class="n">owner</span> <span class="o">=</span> <span class="s1">'None'</span> <span class="k">if</span> <span class="n">dep</span><span class="o">.</span><span class="n">owner</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> class'</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">owner</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Parameters supplied to the depends decorator, '</span>
                             <span class="s1">'must be bound to a Parameterized class or '</span>
                             <span class="s1">'instance not </span><span class="si">%s</span><span class="s1">.'</span> <span class="o">%</span> <span class="n">owner</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">)</span> <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">deps</span><span class="p">)</span> <span class="ow">and</span>
        <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">deps</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Dependencies must either be defined as strings '</span>
                         <span class="s1">'referencing parameters on the class defining '</span>
                         <span class="s1">'the decorated method or as parameter instances. '</span>
                         <span class="s1">'Mixing of string specs and parameter instances '</span>
                         <span class="s1">'is not supported.'</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">string_specs</span> <span class="ow">and</span> <span class="n">kw</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">'Supplying keywords to the decorated method '</span>
                             <span class="s1">'or function is not supported when referencing '</span>
                             <span class="s1">'parameters by name.'</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">string_specs</span> <span class="ow">and</span> <span class="n">watch</span><span class="p">:</span> <span class="c1"># string_specs case handled elsewhere (later), in Parameterized.__init__</span>
        <span class="k">def</span> <span class="nf">cb</span><span class="p">(</span><span class="o">*</span><span class="n">events</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="n">dep</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">dependencies</span><span class="p">)</span>
            <span class="n">dep_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="n">dep</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">dep_kwargs</span><span class="p">)</span>

        <span class="n">grouped</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">deps</span><span class="p">:</span>
            <span class="n">grouped</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">owner</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span> <span class="p">[</span><span class="n">dep</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">group</span><span class="p">])</span>

    <span class="n">_dinfo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">'_dinfo'</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">_dinfo</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'dependencies'</span><span class="p">:</span> <span class="n">dependencies</span><span class="p">,</span>
                   <span class="s1">'kw'</span><span class="p">:</span> <span class="n">kw</span><span class="p">,</span> <span class="s1">'watch'</span><span class="p">:</span> <span class="n">watch</span><span class="p">})</span>

    <span class="n">_depends</span><span class="o">.</span><span class="n">_dinfo</span> <span class="o">=</span> <span class="n">_dinfo</span>

    <span class="k">return</span> <span class="n">_depends</span></div>


<div class="viewcode-block" id="output"><a class="viewcode-back" href="../../reference.html#param.__init__.output">[docs]</a><span class="nd">@accept_arguments</span>
<span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">output</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    output allows annotating a method on a Parameterized class to</span>
<span class="sd">    declare that it returns an output of a specific type. The outputs</span>
<span class="sd">    of a Parameterized class can be queried using the</span>
<span class="sd">    Parameterized.param.outputs method. By default the output will</span>
<span class="sd">    inherit the method name but a custom name can be declared by</span>
<span class="sd">    expressing the Parameter type using a keyword argument. Declaring</span>
<span class="sd">    multiple return types using keywords is only supported in Python &gt;= 3.6.</span>

<span class="sd">    The simplest declaration simply declares the method returns an</span>
<span class="sd">    object without any type guarantees, e.g.:</span>

<span class="sd">      @output()</span>

<span class="sd">    If a specific parameter type is specified this is a declaration</span>
<span class="sd">    that the method will return a value of that type, e.g.:</span>

<span class="sd">      @output(param.Number())</span>

<span class="sd">    To override the default name of the output the type may be declared</span>
<span class="sd">    as a keyword argument, e.g.:</span>

<span class="sd">      @output(custom_name=param.Number())</span>

<span class="sd">    Multiple outputs may be declared using keywords mapping from</span>
<span class="sd">    output name to the type for Python &gt;= 3.6 or using tuples of the</span>
<span class="sd">    same format, which is supported for earlier versions, i.e. these</span>
<span class="sd">    two declarations are equivalent:</span>

<span class="sd">      @output(number=param.Number(), string=param.String())</span>

<span class="sd">      @output(('number', param.Number()), ('string', param.String()))</span>

<span class="sd">    output also accepts Python object types which will be upgraded to</span>
<span class="sd">    a ClassSelector, e.g.:</span>

<span class="sd">      @output(int)</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">out</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">out</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">(),</span> <span class="n">i</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">kw</span><span class="p">:</span>
        <span class="n">py_major</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span>
        <span class="n">py_minor</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">minor</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">py_major</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="p">(</span><span class="n">py_major</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">py_minor</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Multiple output declaration using keywords '</span>
                             <span class="s1">'only supported in Python &gt;= 3.6.'</span><span class="p">)</span>
          <span class="c1"># (requires keywords to be kept ordered, which was not true in previous versions)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">i</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">otype</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">())]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)]</span>

    <span class="n">names</span><span class="p">,</span> <span class="n">processed</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">otype</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">otype</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
                <span class="n">otype</span> <span class="o">=</span> <span class="n">otype</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">.import</span> <span class="n">ClassSelector</span>
                <span class="n">otype</span> <span class="o">=</span> <span class="n">ClassSelector</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="n">otype</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">otype</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">otype</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">.import</span> <span class="n">ClassSelector</span>
            <span class="n">otype</span> <span class="o">=</span> <span class="n">ClassSelector</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="n">otype</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">otype</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'output type must be declared with a Parameter class, '</span>
                             <span class="s1">'instance or a Python object type.'</span><span class="p">)</span>
        <span class="n">processed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'When declaring multiple outputs each value '</span>
                         <span class="s1">'must be unique.'</span><span class="p">)</span>

    <span class="n">_dinfo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">'_dinfo'</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">_dinfo</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'outputs'</span><span class="p">:</span> <span class="n">processed</span><span class="p">})</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_output</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="n">_output</span><span class="o">.</span><span class="n">_dinfo</span> <span class="o">=</span> <span class="n">_dinfo</span>

    <span class="k">return</span> <span class="n">_output</span></div>


<span class="k">def</span> <span class="nf">_params_depended_on</span><span class="p">(</span><span class="n">minfo</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dinfo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">minfo</span><span class="o">.</span><span class="n">method</span><span class="p">,</span><span class="s2">"_dinfo"</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'dependencies'</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">minfo</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">param</span><span class="p">)):</span>
        <span class="n">things</span> <span class="o">=</span> <span class="p">(</span><span class="n">minfo</span><span class="o">.</span><span class="n">inst</span> <span class="ow">or</span> <span class="n">minfo</span><span class="o">.</span><span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_spec_to_obj</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">things</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span><span class="n">PInfo</span><span class="p">):</span>
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">+=</span> <span class="n">_params_depended_on</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">params</span>


<span class="k">def</span> <span class="nf">_m_caller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">asyncio</span>
        <span class="nd">@asyncio</span><span class="o">.</span><span class="n">coroutine</span>
        <span class="k">def</span> <span class="nf">caller</span><span class="p">(</span><span class="o">*</span><span class="n">events</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">function</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">caller</span><span class="p">(</span><span class="o">*</span><span class="n">events</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">()</span>
    <span class="n">caller</span><span class="o">.</span><span class="n">_watcher_name</span> <span class="o">=</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">caller</span>


<span class="n">PInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"PInfo"</span><span class="p">,</span><span class="s2">"inst cls name pobj what"</span><span class="p">)</span>
<span class="n">MInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"MInfo"</span><span class="p">,</span><span class="s2">"inst cls name method"</span><span class="p">)</span>
<span class="n">Event</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"Event"</span><span class="p">,</span><span class="s2">"what name obj cls old new type"</span><span class="p">)</span>
<span class="n">Watcher</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"Watcher"</span><span class="p">,</span><span class="s2">"inst cls fn mode onlychanged parameter_names what queued"</span><span class="p">)</span>

<div class="viewcode-block" id="ParameterMetaclass"><a class="viewcode-back" href="../../reference.html#param.__init__.ParameterMetaclass">[docs]</a><span class="k">class</span> <span class="nc">ParameterMetaclass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Metaclass allowing control over creation of Parameter classes.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">classname</span><span class="p">,</span><span class="n">bases</span><span class="p">,</span><span class="n">classdict</span><span class="p">):</span>
        <span class="c1"># store the class's docstring in __classdoc</span>
        <span class="k">if</span> <span class="s1">'__doc__'</span> <span class="ow">in</span> <span class="n">classdict</span><span class="p">:</span>
            <span class="n">classdict</span><span class="p">[</span><span class="s1">'__classdoc'</span><span class="p">]</span><span class="o">=</span><span class="n">classdict</span><span class="p">[</span><span class="s1">'__doc__'</span><span class="p">]</span>
        <span class="c1"># when asking for help on Parameter *object*, return the doc</span>
        <span class="c1"># slot</span>
        <span class="n">classdict</span><span class="p">[</span><span class="s1">'__doc__'</span><span class="p">]</span><span class="o">=</span><span class="nb">property</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">))</span>

        <span class="c1"># To get the benefit of slots, subclasses must themselves define</span>
        <span class="c1"># __slots__, whether or not they define attributes not present in</span>
        <span class="c1"># the base Parameter class.  That's because a subclass will have</span>
        <span class="c1"># a __dict__ unless it also defines __slots__.</span>
        <span class="k">if</span> <span class="s1">'__slots__'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">classdict</span><span class="p">:</span>
            <span class="n">classdict</span><span class="p">[</span><span class="s1">'__slots__'</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">classname</span><span class="p">,</span><span class="n">bases</span><span class="p">,</span><span class="n">classdict</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattribute__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">==</span><span class="s1">'__doc__'</span><span class="p">:</span>
            <span class="c1"># when asking for help on Parameter *class*, return the</span>
            <span class="c1"># stored class docstring</span>
            <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="s1">'__classdoc'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">name</span><span class="p">)</span></div>



<span class="c1"># CEBALERT: we break some aspects of slot handling for Parameter and</span>
<span class="c1"># Parameterized. The __new__ methods in the metaclasses for those two</span>
<span class="c1"># classes omit to handle the case where __dict__ is passed in</span>
<span class="c1"># __slots__ (and they possibly omit other things too). Additionally,</span>
<span class="c1"># various bits of code in the Parameterized class assumes that all</span>
<span class="c1"># Parameterized instances have a __dict__, but I'm not sure that's</span>
<span class="c1"># guaranteed to be true (although it's true at the moment).</span>


<span class="c1"># CB: we could maybe reduce the complexity by doing something to allow</span>
<span class="c1"># a parameter to discover things about itself when created (would also</span>
<span class="c1"># allow things like checking a Parameter is owned by a</span>
<span class="c1"># Parameterized). I have some vague ideas about what to do.</span>
<div class="viewcode-block" id="Parameter"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameter">[docs]</a><span class="nd">@add_metaclass</span><span class="p">(</span><span class="n">ParameterMetaclass</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Parameter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    An attribute descriptor for declaring parameters.</span>

<span class="sd">    Parameters are a special kind of class attribute.  Setting a</span>
<span class="sd">    Parameterized class attribute to be a Parameter instance causes</span>
<span class="sd">    that attribute of the class (and the class's instances) to be</span>
<span class="sd">    treated as a Parameter.  This allows special behavior, including</span>
<span class="sd">    dynamically generated parameter values, documentation strings,</span>
<span class="sd">    constant and read-only parameters, and type or range checking at</span>
<span class="sd">    assignment time.</span>

<span class="sd">    For example, suppose someone wants to define two new kinds of</span>
<span class="sd">    objects Foo and Bar, such that Bar has a parameter delta, Foo is a</span>
<span class="sd">    subclass of Bar, and Foo has parameters alpha, sigma, and gamma</span>
<span class="sd">    (and delta inherited from Bar).  She would begin her class</span>
<span class="sd">    definitions with something like this:</span>

<span class="sd">    class Bar(Parameterized):</span>
<span class="sd">        delta = Parameter(default=0.6, doc='The difference between steps.')</span>
<span class="sd">        ...</span>

<span class="sd">    class Foo(Bar):</span>
<span class="sd">        alpha = Parameter(default=0.1, doc='The starting value.')</span>
<span class="sd">        sigma = Parameter(default=0.5, doc='The standard deviation.',</span>
<span class="sd">                          constant=True)</span>
<span class="sd">        gamma = Parameter(default=1.0, doc='The ending value.')</span>
<span class="sd">        ...</span>

<span class="sd">    Class Foo would then have four parameters, with delta defaulting</span>
<span class="sd">    to 0.6.</span>

<span class="sd">    Parameters have several advantages over plain attributes:</span>

<span class="sd">    1. Parameters can be set automatically when an instance is</span>
<span class="sd">       constructed: The default constructor for Foo (and Bar) will</span>
<span class="sd">       accept arbitrary keyword arguments, each of which can be used</span>
<span class="sd">       to specify the value of a Parameter of Foo (or any of Foo's</span>
<span class="sd">       superclasses).  E.g., if a script does this:</span>

<span class="sd">           myfoo = Foo(alpha=0.5)</span>

<span class="sd">       myfoo.alpha will return 0.5, without the Foo constructor</span>
<span class="sd">       needing special code to set alpha.</span>

<span class="sd">       If Foo implements its own constructor, keyword arguments will</span>
<span class="sd">       still be accepted if the constructor accepts a dictionary of</span>
<span class="sd">       keyword arguments (as in ``def __init__(self,**params):``), and</span>
<span class="sd">       then each class calls its superclass (as in</span>
<span class="sd">       ``super(Foo,self).__init__(**params)``) so that the</span>
<span class="sd">       Parameterized constructor will process the keywords.</span>

<span class="sd">    2. A Parameterized class need specify only the attributes of a</span>
<span class="sd">       Parameter whose values differ from those declared in</span>
<span class="sd">       superclasses; the other values will be inherited.  E.g. if Foo</span>
<span class="sd">       declares</span>

<span class="sd">        delta = Parameter(default=0.2)</span>

<span class="sd">       the default value of 0.2 will override the 0.6 inherited from</span>
<span class="sd">       Bar, but the doc will be inherited from Bar.</span>

<span class="sd">    3. The Parameter descriptor class can be subclassed to provide</span>
<span class="sd">       more complex behavior, allowing special types of parameters</span>
<span class="sd">       that, for example, require their values to be numbers in</span>
<span class="sd">       certain ranges, generate their values dynamically from a random</span>
<span class="sd">       distribution, or read their values from a file or other</span>
<span class="sd">       external source.</span>

<span class="sd">    4. The attributes associated with Parameters provide enough</span>
<span class="sd">       information for automatically generating property sheets in</span>
<span class="sd">       graphical user interfaces, allowing Parameterized instances to</span>
<span class="sd">       be edited by users.</span>

<span class="sd">    Note that Parameters can only be used when set as class attributes</span>
<span class="sd">    of Parameterized classes. Parameters used as standalone objects,</span>
<span class="sd">    or as class attributes of non-Parameterized classes, will not have</span>
<span class="sd">    the behavior described here.</span>
<span class="sd">    """</span>

    <span class="c1"># Because they implement __get__ and __set__, Parameters are known</span>
    <span class="c1"># as 'descriptors' in Python; see "Implementing Descriptors" and</span>
    <span class="c1"># "Invoking Descriptors" in the 'Customizing attribute access'</span>
    <span class="c1"># section of the Python reference manual:</span>
    <span class="c1"># http://docs.python.org/ref/attribute-access.html</span>
    <span class="c1">#</span>
    <span class="c1"># Overview of Parameters for programmers</span>
    <span class="c1"># ======================================</span>
    <span class="c1">#</span>
    <span class="c1"># Consider the following code:</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># class A(Parameterized):</span>
    <span class="c1">#     p = Parameter(default=1)</span>
    <span class="c1">#</span>
    <span class="c1"># a1 = A()</span>
    <span class="c1"># a2 = A()</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># * a1 and a2 share one Parameter object (A.__dict__['p']).</span>
    <span class="c1">#</span>
    <span class="c1"># * The default (class) value of p is stored in this Parameter</span>
    <span class="c1">#   object (A.__dict__['p'].default).</span>
    <span class="c1">#</span>
    <span class="c1"># * If the value of p is set on a1 (e.g. a1.p=2), a1's value of p</span>
    <span class="c1">#   is stored in a1 itself (a1.__dict__['_p_param_value'])</span>
    <span class="c1">#</span>
    <span class="c1"># * When a1.p is requested, a1.__dict__['_p_param_value'] is</span>
    <span class="c1">#   returned. When a2.p is requested, '_p_param_value' is not</span>
    <span class="c1">#   found in a2.__dict__, so A.__dict__['p'].default (i.e. A.p) is</span>
    <span class="c1">#   returned instead.</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># Be careful when referring to the 'name' of a Parameter:</span>
    <span class="c1">#</span>
    <span class="c1"># * A Parameterized class has a name for the attribute which is</span>
    <span class="c1">#   being represented by the Parameter ('p' in the example above);</span>
    <span class="c1">#   in the code, this is called the 'attrib_name'.</span>
    <span class="c1">#</span>
    <span class="c1"># * When a Parameterized instance has its own local value for a</span>
    <span class="c1">#   parameter, it is stored as '_X_param_value' (where X is the</span>
    <span class="c1">#   attrib_name for the Parameter); in the code, this is called</span>
    <span class="c1">#   the internal_name.</span>


    <span class="c1"># So that the extra features of Parameters do not require a lot of</span>
    <span class="c1"># overhead, Parameters are implemented using __slots__ (see</span>
    <span class="c1"># http://www.python.org/doc/2.4/ref/slots.html).  Instead of having</span>
    <span class="c1"># a full Python dictionary associated with each Parameter instance,</span>
    <span class="c1"># Parameter instances have an enumerated list (named __slots__) of</span>
    <span class="c1"># attributes, and reserve just enough space to store these</span>
    <span class="c1"># attributes.  Using __slots__ requires special support for</span>
    <span class="c1"># operations to copy and restore Parameters (e.g. for Python</span>
    <span class="c1"># persistent storage pickling); see __getstate__ and __setstate__.</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'_internal_name'</span><span class="p">,</span> <span class="s1">'default'</span><span class="p">,</span> <span class="s1">'doc'</span><span class="p">,</span>
                 <span class="s1">'precedence'</span><span class="p">,</span> <span class="s1">'instantiate'</span><span class="p">,</span> <span class="s1">'constant'</span><span class="p">,</span> <span class="s1">'readonly'</span><span class="p">,</span>
                 <span class="s1">'pickle_default_value'</span><span class="p">,</span> <span class="s1">'allow_None'</span><span class="p">,</span> <span class="s1">'per_instance'</span><span class="p">,</span>
                 <span class="s1">'watchers'</span><span class="p">,</span> <span class="s1">'owner'</span><span class="p">,</span> <span class="s1">'_label'</span><span class="p">]</span>

    <span class="c1"># Note: When initially created, a Parameter does not know which</span>
    <span class="c1"># Parameterized class owns it, nor does it know its names</span>
    <span class="c1"># (attribute name, internal name). Once the owning Parameterized</span>
    <span class="c1"># class is created, owner, name, and _internal_name are</span>
    <span class="c1"># set.</span>

    <span class="n">_serializers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'json'</span><span class="p">:</span> <span class="n">serializer</span><span class="o">.</span><span class="n">JSONSerialization</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># pylint: disable-msg=R0913</span>
                 <span class="n">instantiate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">pickle_default_value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">per_instance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="sd">"""Initialize a new Parameter object and store the supplied attributes:</span>

<span class="sd">        default: the owning class's value for the attribute represented</span>
<span class="sd">        by this Parameter, which can be overridden in an instance.</span>

<span class="sd">        doc: docstring explaining what this parameter represents.</span>

<span class="sd">        label: optional text label to be used when this Parameter is</span>
<span class="sd">        shown in a listing. If no label is supplied, the attribute name</span>
<span class="sd">        for this parameter in the owning Parameterized object is used.</span>

<span class="sd">        precedence: a numeric value, usually in the range 0.0 to 1.0,</span>
<span class="sd">        which allows the order of Parameters in a class to be defined in</span>
<span class="sd">        a listing or e.g. in GUI menus. A negative precedence indicates</span>
<span class="sd">        a parameter that should be hidden in such listings.</span>

<span class="sd">        instantiate: controls whether the value of this Parameter will</span>
<span class="sd">        be deepcopied when a Parameterized object is instantiated (if</span>
<span class="sd">        True), or if the single default value will be shared by all</span>
<span class="sd">        Parameterized instances (if False). For an immutable Parameter</span>
<span class="sd">        value, it is best to leave instantiate at the default of</span>
<span class="sd">        False, so that a user can choose to change the value at the</span>
<span class="sd">        Parameterized instance level (affecting only that instance) or</span>
<span class="sd">        at the Parameterized class or superclass level (affecting all</span>
<span class="sd">        existing and future instances of that class or superclass). For</span>
<span class="sd">        a mutable Parameter value, the default of False is also appropriate</span>
<span class="sd">        if you want all instances to share the same value state, e.g. if</span>
<span class="sd">        they are each simply referring to a single global object like</span>
<span class="sd">        a singleton. If instead each Parameterized should have its own</span>
<span class="sd">        independently mutable value, instantiate should be set to</span>
<span class="sd">        True, but note that there is then no simple way to change the</span>
<span class="sd">        value of this Parameter at the class or superclass level,</span>
<span class="sd">        because each instance, once created, will then have an</span>
<span class="sd">        independently instantiated value.</span>

<span class="sd">        constant: if true, the Parameter value can be changed only at</span>
<span class="sd">        the class level or in a Parameterized constructor call. The</span>
<span class="sd">        value is otherwise constant on the Parameterized instance,</span>
<span class="sd">        once it has been constructed.</span>

<span class="sd">        readonly: if true, the Parameter value cannot ordinarily be</span>
<span class="sd">        changed by setting the attribute at the class or instance</span>
<span class="sd">        levels at all. The value can still be changed in code by</span>
<span class="sd">        temporarily overriding the value of this slot and then</span>
<span class="sd">        restoring it, which is useful for reporting values that the</span>
<span class="sd">        _user_ should never change but which do change during code</span>
<span class="sd">        execution.</span>

<span class="sd">        pickle_default_value: whether the default value should be</span>
<span class="sd">        pickled. Usually, you would want the default value to be pickled,</span>
<span class="sd">        but there are rare cases where that would not be the case (e.g.</span>
<span class="sd">        for file search paths that are specific to a certain system).</span>

<span class="sd">        per_instance: whether a separate Parameter instance will be</span>
<span class="sd">        created for every Parameterized instance. True by default.</span>
<span class="sd">        If False, all instances of a Parameterized class will share</span>
<span class="sd">        the same Parameter object, including all validation</span>
<span class="sd">        attributes (bounds, etc.). See also instantiate, which is</span>
<span class="sd">        conceptually similar but affects the Parameter value rather</span>
<span class="sd">        than the Parameter object.</span>

<span class="sd">        allow_None: if True, None is accepted as a valid value for</span>
<span class="sd">        this Parameter, in addition to any other values that are</span>
<span class="sd">        allowed. If the default value is defined as None, allow_None</span>
<span class="sd">        is set to True automatically.</span>

<span class="sd">        default, doc, and precedence all default to None, which allows</span>
<span class="sd">        inheritance of Parameter slots (attributes) from the owning-class'</span>
<span class="sd">        class hierarchy (see ParameterizedMetaclass).</span>
<span class="sd">        """</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precedence</span> <span class="o">=</span> <span class="n">precedence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">doc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="n">constant</span> <span class="ow">or</span> <span class="n">readonly</span> <span class="c1"># readonly =&gt; constant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span> <span class="o">=</span> <span class="n">readonly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_internal_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_instantiate</span><span class="p">(</span><span class="n">instantiate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pickle_default_value</span> <span class="o">=</span> <span class="n">pickle_default_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span> <span class="o">=</span> <span class="p">(</span><span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">allow_None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">watchers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">per_instance</span> <span class="o">=</span> <span class="n">per_instance</span>

<div class="viewcode-block" id="Parameter.serialize"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameter.serialize">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="s2">"Given the parameter value, return a Python value suitable for serialization"</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Parameter.deserialize"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameter.deserialize">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="s2">"Given a serializable Python value, return a value that the parameter can be set to"</span>
        <span class="k">return</span> <span class="n">value</span></div>

    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'json'</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">serializer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">'Cannot import serializer.py needed to generate schema'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_serializers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">'Mode </span><span class="si">%r</span><span class="s1"> not in available serialization formats </span><span class="si">%r</span><span class="s1">'</span>
                           <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_serializers</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serializers</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span><span class="o">.</span><span class="n">parameter_schema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
                                                        <span class="n">safe</span><span class="o">=</span><span class="n">safe</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">label_formatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span>

    <span class="nd">@label</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_set_instantiate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">instantiate</span><span class="p">):</span>
        <span class="sd">"""Constant parameters must be instantiated."""</span>
        <span class="c1"># CB: instantiate doesn't actually matter for read-only</span>
        <span class="c1"># parameters, since they can't be set even on a class.  But</span>
        <span class="c1"># this avoids needless instantiation.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instantiate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instantiate</span> <span class="o">=</span> <span class="n">instantiate</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="c1"># pylint: disable-msg=W0201</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">implemented</span> <span class="o">=</span> <span class="p">(</span><span class="n">attribute</span> <span class="o">!=</span> <span class="s2">"default"</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'watchers'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">watchers</span><span class="p">)</span>
        <span class="n">slot_attribute</span> <span class="o">=</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">old</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span> <span class="k">if</span> <span class="n">implemented</span> <span class="k">else</span> <span class="bp">NotImplemented</span>
            <span class="k">if</span> <span class="n">slot_attribute</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_on_set</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">slot_attribute</span><span class="p">:</span>
                <span class="c1"># If Parameter slot is defined but an AttributeError was raised</span>
                <span class="c1"># we are in __setstate__ and watchers should not be triggered</span>
                <span class="n">old</span> <span class="o">=</span> <span class="bp">NotImplemented</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Parameter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">old</span> <span class="ow">is</span> <span class="bp">NotImplemented</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="n">attribute</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span>
                      <span class="n">old</span><span class="o">=</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">watcher</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">watchers</span><span class="p">[</span><span class="n">attribute</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_call_watcher</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_batch_call_watchers</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Can be overridden on subclasses to handle changes when parameter</span>
<span class="sd">        attribute is set.</span>
<span class="sd">        """</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">objtype</span><span class="p">):</span> <span class="c1"># pylint: disable-msg=W0613</span>
        <span class="sd">"""</span>
<span class="sd">        Return the value for this Parameter.</span>

<span class="sd">        If called for a Parameterized class, produce that</span>
<span class="sd">        class's value (i.e. this Parameter object's 'default'</span>
<span class="sd">        attribute).</span>

<span class="sd">        If called for a Parameterized instance, produce that</span>
<span class="sd">        instance's value, if one has been set - otherwise produce the</span>
<span class="sd">        class's value (default).</span>
<span class="sd">        """</span>
        <span class="c1"># NB: obj can be None (when __get__ called for a</span>
        <span class="c1"># Parameterized class); objtype is never None</span>

        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@instance_descriptor</span>
    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Set the value for this Parameter.</span>

<span class="sd">        If called for a Parameterized class, set that class's</span>
<span class="sd">        value (i.e. set this Parameter object's 'default' attribute).</span>

<span class="sd">        If called for a Parameterized instance, set the value of</span>
<span class="sd">        this Parameter on that instance (i.e. in the instance's</span>
<span class="sd">        __dict__, under the parameter's internal_name).</span>


<span class="sd">        If the Parameter's constant attribute is True, only allows</span>
<span class="sd">        the value to be set for a Parameterized class or on</span>
<span class="sd">        uninitialized Parameterized instances.</span>

<span class="sd">        If the Parameter's readonly attribute is True, only allows the</span>
<span class="sd">        value to be specified in the Parameter declaration inside the</span>
<span class="sd">        Parameterized source code. A read-only parameter also</span>
<span class="sd">        cannot be set on a Parameterized class.</span>

<span class="sd">        Note that until we support some form of read-only</span>
<span class="sd">        object, it is still possible to change the attributes of the</span>
<span class="sd">        object stored in a constant or read-only Parameter (e.g. the</span>
<span class="sd">        left bound of a BoundingBox).</span>
<span class="sd">        """</span>

        <span class="c1"># ALERT: Deprecated Number set_hook called here to avoid duplicating</span>
        <span class="c1">#        setter, should be removed in 2.0</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'set_hook'</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_hook</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="n">_old</span> <span class="o">=</span> <span class="bp">NotImplemented</span>
        <span class="c1"># NB: obj can be None (when __set__ called for a</span>
        <span class="c1"># Parameterized class)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"Read-only parameter '</span><span class="si">%s</span><span class="s2">' cannot be modified"</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">initialized</span><span class="p">:</span>
                <span class="n">_old</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_old</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_old</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"Constant parameter '</span><span class="si">%s</span><span class="s2">' cannot be modified"</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_old</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_post_setter</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">watchers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">watchers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"value"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">'_param_watchers'</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param_watchers</span><span class="p">:</span>
            <span class="n">watchers</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param_watchers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">watchers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">watchers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">watchers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"value"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">watchers</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">obj</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">watchers</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s1">'value'</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span>
                      <span class="n">old</span><span class="o">=</span><span class="n">_old</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">watcher</span> <span class="ow">in</span> <span class="n">watchers</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_call_watcher</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_batch_call_watchers</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_validate_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">allow_None</span><span class="p">):</span>
        <span class="sd">"""Implements validation for parameter value"""</span>

    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">"""Implements validation for the parameter value and attributes"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_value</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_post_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">"""Called after the parameter value has been validated and set"""</span>

    <span class="k">def</span> <span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"Cannot delete '</span><span class="si">%s</span><span class="s2">': Parameters deletion not allowed."</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">attrib_name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">'The </span><span class="si">%s</span><span class="s1"> parameter </span><span class="si">%r</span><span class="s1"> has already been '</span>
                                 <span class="s1">'assigned a name by the </span><span class="si">%s</span><span class="s1"> class, '</span>
                                 <span class="s1">'could not assign new name </span><span class="si">%r</span><span class="s1">. Parameters '</span>
                                 <span class="s1">'may not be shared by multiple classes; '</span>
                                 <span class="s1">'ensure that you create a new parameter '</span>
                                 <span class="s1">'instance for each new class.'</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">attrib_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">attrib_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_internal_name</span> <span class="o">=</span> <span class="s2">"_</span><span class="si">%s</span><span class="s2">_param_value"</span> <span class="o">%</span> <span class="n">attrib_name</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        All Parameters have slots, not a dict, so we have to support</span>
<span class="sd">        pickle and deepcopy ourselves.</span>
<span class="sd">        """</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">get_occupied_slots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">state</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">slot</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="p">):</span>
        <span class="c1"># set values of __slots__ (instead of in non-existent __dict__)</span>

        <span class="c1"># Handle renamed slots introduced for instance params</span>
        <span class="k">if</span> <span class="s1">'_attrib_name'</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'_attrib_name'</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">'_owner'</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="s1">'owner'</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'_owner'</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">'watchers'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="s1">'watchers'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s1">'per_instance'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="s1">'per_instance'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">'_label'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="s1">'_label'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span></div>


<span class="c1"># Define one particular type of Parameter that is used in this file</span>
<div class="viewcode-block" id="String"><a class="viewcode-back" href="../../reference.html#param.__init__.String">[docs]</a><span class="k">class</span> <span class="nc">String</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A String Parameter, with a default value and optional regular expression (regex) matching.</span>

<span class="sd">    Example of using a regex to implement IPv4 address matching::</span>

<span class="sd">      class IPAddress(String):</span>
<span class="sd">        '''IPv4 address as a string (dotted decimal notation)'''</span>
<span class="sd">       def __init__(self, default="0.0.0.0", allow_None=False, **kwargs):</span>
<span class="sd">           ip_regex = '^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$'</span>
<span class="sd">           super(IPAddress, self).__init__(default=default, regex=ip_regex, **kwargs)</span>

<span class="sd">    """</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'regex'</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="n">allow_None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regex</span> <span class="o">=</span> <span class="n">regex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span> <span class="o">=</span> <span class="p">(</span><span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">allow_None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_regex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">regex</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">regex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"String parameter </span><span class="si">%r</span><span class="s2"> value </span><span class="si">%r</span><span class="s2"> does not match regex </span><span class="si">%r</span><span class="s2">."</span>
                             <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">regex</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_validate_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">allow_None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">allow_None</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"String parameter </span><span class="si">%r</span><span class="s2"> only takes a string value, "</span>
                             <span class="s2">"not value of type </span><span class="si">%s</span><span class="s2">."</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_value</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_regex</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span><span class="p">)</span></div>


<div class="viewcode-block" id="shared_parameters"><a class="viewcode-back" href="../../reference.html#param.__init__.shared_parameters">[docs]</a><span class="k">class</span> <span class="nc">shared_parameters</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Context manager to share parameter instances when creating</span>
<span class="sd">    multiple Parameterized objects of the same type. Parameter default</span>
<span class="sd">    values are instantiated once and cached to be reused when another</span>
<span class="sd">    Parameterized object of the same type is instantiated.</span>
<span class="sd">    Can be useful to easily modify large collections of Parameterized</span>
<span class="sd">    objects at once and can provide a significant speedup.</span>
<span class="sd">    """</span>

    <span class="n">_share</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_shared_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_share</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_share</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_shared_cache</span> <span class="o">=</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="as_uninitialized"><a class="viewcode-back" href="../../reference.html#param.__init__.as_uninitialized">[docs]</a><span class="k">def</span> <span class="nf">as_uninitialized</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Decorator: call fn with the parameterized_instance's</span>
<span class="sd">    initialization flag set to False, then revert the flag.</span>

<span class="sd">    (Used to decorate Parameterized methods that must alter</span>
<span class="sd">    a constant Parameter.)</span>
<span class="sd">    """</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">override_initialization</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">parameterized_instance</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>
        <span class="n">original_initialized</span> <span class="o">=</span> <span class="n">parameterized_instance</span><span class="o">.</span><span class="n">initialized</span>
        <span class="n">parameterized_instance</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">fn</span><span class="p">(</span><span class="n">parameterized_instance</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">parameterized_instance</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="n">original_initialized</span>
    <span class="k">return</span> <span class="n">override_initialization</span></div>


<div class="viewcode-block" id="Comparator"><a class="viewcode-back" href="../../reference.html#param.__init__.Comparator">[docs]</a><span class="k">class</span> <span class="nc">Comparator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Comparator defines methods for determining whether two objects</span>
<span class="sd">    should be considered equal. It works by registering custom</span>
<span class="sd">    comparison functions, which may either be registed by type or with</span>
<span class="sd">    a predicate function. If no matching comparison can be found for</span>
<span class="sd">    the two objects the comparison will return False.</span>

<span class="sd">    If registered by type the Comparator will check whether both</span>
<span class="sd">    objects are of that type and apply the comparison. If the equality</span>
<span class="sd">    function is instead registered with a function it will call the</span>
<span class="sd">    function with each object individually to check if the comparison</span>
<span class="sd">    applies. This is useful for defining comparisons for objects</span>
<span class="sd">    without explicitly importing them.</span>

<span class="sd">    To use the Comparator simply call the is_equal function.</span>
<span class="sd">    """</span>

    <span class="n">equalities</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>
        <span class="n">basestring</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>
        <span class="nb">bytes</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>
        <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span>
    <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_equal</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">eq_type</span><span class="p">,</span> <span class="n">eq</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">equalities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">eq_type</span><span class="p">,</span> <span class="n">FunctionType</span><span class="p">)</span>
                 <span class="ow">and</span> <span class="n">eq_type</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">eq_type</span><span class="p">(</span><span class="n">obj2</span><span class="p">))</span>
                <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">eq_type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj2</span><span class="p">,</span> <span class="n">eq_type</span><span class="p">))):</span>
                <span class="k">return</span> <span class="n">eq</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj2</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">compare_iterator</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj2</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">compare_mapping</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">compare_iterator</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj2</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">compare_mapping</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj2</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj2</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj2</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="n">obj1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">obj2</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Parameters"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters">[docs]</a><span class="k">class</span> <span class="nc">Parameters</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""Object that holds the namespace and implementation of Parameterized</span>
<span class="sd">    methods as well as any state that is not in __slots__ or the</span>
<span class="sd">    Parameters themselves.</span>

<span class="sd">    Exists at both the metaclass level (instantiated by the metaclass)</span>
<span class="sd">    and at the instance level. Can contain state specific to either the</span>
<span class="sd">    class or the instance as necessary.</span>
<span class="sd">    """</span>

    <span class="n">_disable_stubs</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Flag used to disable stubs in the API1 tests</span>
                          <span class="c1"># None for no action, True to raise and False to warn.</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        cls is the Parameterized class which is always set.</span>
<span class="sd">        self is the instance if set.</span>
<span class="sd">        """</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="bp">cls</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_BATCH_WATCH</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_parameters_state</span><span class="p">[</span><span class="s1">'BATCH_WATCH'</span><span class="p">]</span>

    <span class="nd">@_BATCH_WATCH</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_BATCH_WATCH</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_parameters_state</span><span class="p">[</span><span class="s1">'BATCH_WATCH'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_TRIGGER</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_parameters_state</span><span class="p">[</span><span class="s1">'TRIGGER'</span><span class="p">]</span>

    <span class="nd">@_TRIGGER</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_TRIGGER</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_parameters_state</span><span class="p">[</span><span class="s1">'TRIGGER'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_events</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_parameters_state</span><span class="p">[</span><span class="s1">'events'</span><span class="p">]</span>

    <span class="nd">@_events</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_events</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_parameters_state</span><span class="p">[</span><span class="s1">'events'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_watchers</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_parameters_state</span><span class="p">[</span><span class="s1">'watchers'</span><span class="p">]</span>

    <span class="nd">@_watchers</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_watchers</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_parameters_state</span><span class="p">[</span><span class="s1">'watchers'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">self_or_cls</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span> <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="c1"># Set old parameters state on Parameterized._parameters_state</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'self'</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'cls'</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_parameters_state</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s1">'_'</span><span class="o">+</span><span class="n">k</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_parameters_state</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Returns the class or instance parameter</span>
<span class="sd">        """</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">inst</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">inst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="s1">'initialized'</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">per_instance</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="s1">'_disable_instance__params'</span><span class="p">,</span> <span class="kc">False</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inst</span><span class="o">.</span><span class="n">_instance__params</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Do not copy watchers on class parameter</span>
                    <span class="n">watchers</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">watchers</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">watchers</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">watchers</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">watchers</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="n">p</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">inst</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">_instance__params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">_instance__params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">p</span>


    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Adds parameters to dir</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Parameters</span><span class="p">,</span> <span class="n">self_</span><span class="p">)</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">self_</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Iterates over the parameters on this object.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">self_</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">p</span>


    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">self_</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Extends attribute access to parameter objects.</span>
<span class="sd">        """</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'cls'</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># Class not initialized</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">'_</span><span class="si">%s</span><span class="s1">__params'</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="n">classlist</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">class_</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">"type object '</span><span class="si">%s</span><span class="s2">.param' has no attribute </span><span class="si">%r</span><span class="s2">"</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">"'</span><span class="si">%s</span><span class="s2">.param' object has no attribute </span><span class="si">%r</span><span class="s2">"</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>


    <span class="nd">@as_uninitialized</span>
    <span class="k">def</span> <span class="nf">_set_name</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>


    <span class="nd">@as_uninitialized</span>
    <span class="k">def</span> <span class="nf">_generate_name</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_set_name</span><span class="p">(</span><span class="s1">'</span><span class="si">%s%05d</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="p">,</span><span class="n">object_count</span><span class="p">))</span>


    <span class="nd">@as_uninitialized</span>
    <span class="k">def</span> <span class="nf">_setup_params</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Initialize default and keyword parameter values.</span>

<span class="sd">        First, ensures that all Parameters with 'instantiate=True'</span>
<span class="sd">        (typically used for mutable Parameters) are copied directly</span>
<span class="sd">        into each object, to ensure that there is an independent copy</span>
<span class="sd">        (to avoid surprising aliasing errors).  Then sets each of the</span>
<span class="sd">        keyword arguments, warning when any of them are not defined as</span>
<span class="sd">        parameters.</span>

<span class="sd">        Constant Parameters can be set during calls to this method.</span>
<span class="sd">        """</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">self</span>
        <span class="c1">## Deepcopy all 'instantiate=True' parameters</span>
        <span class="c1"># (build a set of names first to avoid redundantly instantiating</span>
        <span class="c1">#  a later-overridden parent class's parameter)</span>
        <span class="n">params_to_instantiate</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="n">classlist</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">class_</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">class_</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># (avoid replacing name with the default of None)</span>
                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">instantiate</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">"name"</span><span class="p">:</span>
                    <span class="n">params_to_instantiate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params_to_instantiate</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_instantiate_param</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1">## keyword arg setting</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">get_param_descriptor</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># pylint: disable-msg=E1101</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">desc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Setting non-parameter attribute </span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2"> using a mechanism intended only for parameters"</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="c1"># i.e. if not desc it's setting an attribute in __dict__, not a Parameter</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">deprecate</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Decorator to issue warnings for API moving onto the param</span>
<span class="sd">        namespace and to add a docstring directing people to the</span>
<span class="sd">        appropriate method.</span>
<span class="sd">        """</span>
        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_disable_stubs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">'Stubs supporting old API disabled'</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_disable_stubs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_disable_stubs</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">get_logger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="n">WARNING</span><span class="p">,</span> <span class="s1">'Use method </span><span class="si">%r</span><span class="s1"> via param namespace '</span> <span class="o">%</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">inner</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">=</span> <span class="s2">"Inspect .param.</span><span class="si">%s</span><span class="s2"> method for the full docstring"</span>  <span class="o">%</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="n">inner</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_changed</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Predicate that determines whether a Event object has actually</span>
<span class="sd">        changed such that old != new.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">Comparator</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">old</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">new</span><span class="p">)</span>


    <span class="c1"># CEBALERT: this is a bit ugly</span>
    <span class="k">def</span> <span class="nf">_instantiate_param</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">param_obj</span><span class="p">,</span> <span class="n">dict_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># deepcopy param_obj.default into self.__dict__ (or dict_ if supplied)</span>
        <span class="c1"># under the parameter's _internal_name (or key if supplied)</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>
        <span class="n">dict_</span> <span class="o">=</span> <span class="n">dict_</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span> <span class="ow">or</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">_internal_name</span>
        <span class="k">if</span> <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_share</span><span class="p">:</span>
            <span class="n">param_key</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">param_key</span> <span class="ow">in</span> <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_shared_cache</span><span class="p">:</span>
                <span class="n">new_object</span> <span class="o">=</span> <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_shared_cache</span><span class="p">[</span><span class="n">param_key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_object</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">param_obj</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
                <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_shared_cache</span><span class="p">[</span><span class="n">param_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_object</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">param_obj</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>

        <span class="n">dict_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_object</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_object</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">):</span>
            <span class="k">global</span> <span class="n">object_count</span>
            <span class="n">object_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># CB: writes over name given to the original object;</span>
            <span class="c1"># should it instead keep the same name?</span>
            <span class="n">new_object</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_generate_name</span><span class="p">()</span>

    <span class="c1"># Classmethods</span>

<div class="viewcode-block" id="Parameters.print_param_defaults"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.print_param_defaults">[docs]</a>    <span class="k">def</span> <span class="nf">print_param_defaults</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="sd">"""Print the default values of all cls's Parameters."""</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">Parameter</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">'.'</span><span class="o">+</span><span class="n">key</span><span class="o">+</span> <span class="s1">'='</span><span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">default</span><span class="p">))</span></div>


<div class="viewcode-block" id="Parameters.set_default"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.set_default">[docs]</a>    <span class="k">def</span> <span class="nf">set_default</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">param_name</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Set the default value of param_name.</span>

<span class="sd">        Equivalent to setting param_name on the class.</span>
<span class="sd">        """</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">param_name</span><span class="p">,</span><span class="n">value</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_add_parameter</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span><span class="n">param_obj</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Add a new Parameter object into this object's class.</span>

<span class="sd">        Supposed to result in a Parameter equivalent to one declared</span>
<span class="sd">        in the class's source code.</span>
<span class="sd">        """</span>
        <span class="c1"># CEBALERT: can't we just do</span>
        <span class="c1"># setattr(cls,param_name,param_obj)?  The metaclass's</span>
        <span class="c1"># __setattr__ is actually written to handle that.  (Would also</span>
        <span class="c1"># need to do something about the params() cache.  That cache</span>
        <span class="c1"># is a pain, but it definitely improved the startup time; it</span>
        <span class="c1"># would be worthwhile making sure no method except for one</span>
        <span class="c1"># "add_param()" method has to deal with it (plus any future</span>
        <span class="c1"># remove_param() method.)</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span>
        <span class="nb">type</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">param_name</span><span class="p">,</span><span class="n">param_obj</span><span class="p">)</span>
        <span class="n">ParameterizedMetaclass</span><span class="o">.</span><span class="n">_initialize_parameter</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">param_name</span><span class="p">,</span><span class="n">param_obj</span><span class="p">)</span>
        <span class="c1"># delete cached params()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="s1">'_</span><span class="si">%s</span><span class="s1">__params'</span><span class="o">%</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>


<div class="viewcode-block" id="Parameters.params"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.params">[docs]</a>    <span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">parameter_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return the Parameters of this class as the</span>
<span class="sd">        dictionary {name: parameter_object}</span>

<span class="sd">        Includes Parameters from this class and its</span>
<span class="sd">        superclasses.</span>
<span class="sd">        """</span>
        <span class="n">pdict</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="s1">'existing'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parameter_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pdict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pdict</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span></div>

    <span class="c1"># Bothmethods</span>

<div class="viewcode-block" id="Parameters.set_param"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.set_param">[docs]</a>    <span class="k">def</span> <span class="nf">set_param</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        For each param=value keyword argument, sets the corresponding</span>
<span class="sd">        parameter of this object or class to the given value.</span>

<span class="sd">        For backwards compatibility, also accepts</span>
<span class="sd">        set_param("param",value) for a single parameter value using</span>
<span class="sd">        positional arguments, but the keyword interface is preferred</span>
<span class="sd">        because it is more compact and can set multiple values.</span>
<span class="sd">        """</span>
        <span class="n">BATCH_WATCH</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid positional arguments for </span><span class="si">%s</span><span class="s2">.set_param"</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="n">trigger_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span>
                          <span class="k">if</span> <span class="p">((</span><span class="n">k</span> <span class="ow">in</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="p">)</span> <span class="ow">and</span>
                              <span class="nb">hasattr</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="s1">'_autotrigger_value'</span><span class="p">))]</span>

        <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">trigger_params</span><span class="p">:</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">tp</span><span class="p">]</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="s1">'set'</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="p">:</span>
                <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"'</span><span class="si">%s</span><span class="s2">' is not a parameter of </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">raise</span>

        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="n">BATCH_WATCH</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">BATCH_WATCH</span><span class="p">:</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">_batch_call_watchers</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">trigger_params</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">tp</span><span class="p">]</span>
            <span class="n">p</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="s1">'reset'</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">_autotrigger_reset_value</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="s1">'set-reset'</span></div>

<div class="viewcode-block" id="Parameters.objects"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.objects">[docs]</a>    <span class="k">def</span> <span class="nf">objects</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Returns the Parameters of this instance or class</span>

<span class="sd">        If instance=True and called on a Parameterized instance it</span>
<span class="sd">        will create instance parameters for all Parameters defined on</span>
<span class="sd">        the class. To force class parameters to be returned use</span>
<span class="sd">        instance=False. Since classes avoid creating instance</span>
<span class="sd">        parameters unless necessary you may also request only existing</span>
<span class="sd">        instance parameters to be returned by setting</span>
<span class="sd">        instance='existing'.</span>
<span class="sd">        """</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span>
        <span class="c1"># CB: we cache the parameters because this method is called often,</span>
        <span class="c1"># and parameters are rarely added (and cannot be deleted)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdict</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">'_</span><span class="si">%s</span><span class="s1">__params'</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">paramdict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="n">classlist</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">class_</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
                        <span class="n">paramdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

            <span class="c1"># We only want the cache to be visible to the cls on which</span>
            <span class="c1"># params() is called, so we mangle the name ourselves at</span>
            <span class="c1"># runtime (if we were to mangle it now, it would be</span>
            <span class="c1"># _Parameterized.__params for all classes).</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">'_</span><span class="si">%s</span><span class="s1">__params'</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">paramdict</span><span class="p">)</span>
            <span class="n">pdict</span> <span class="o">=</span> <span class="n">paramdict</span>

        <span class="k">if</span> <span class="n">instance</span> <span class="ow">and</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">instance</span> <span class="o">==</span> <span class="s1">'existing'</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="p">,</span> <span class="s1">'initialized'</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_instance__params</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pdict</span><span class="p">,</span> <span class="o">**</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_instance__params</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pdict</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pdict</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">pdict</span></div>


<div class="viewcode-block" id="Parameters.trigger"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.trigger">[docs]</a>    <span class="k">def</span> <span class="nf">trigger</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">param_names</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Trigger watchers for the given set of parameter names. Watchers</span>
<span class="sd">        will be triggered whether or not the parameter values have</span>
<span class="sd">        actually changed. As a special case, the value will actually be</span>
<span class="sd">        changed for a Parameter of type Event, setting it to True so</span>
<span class="sd">        that it is clear which Event parameter has been triggered.</span>
<span class="sd">        """</span>
        <span class="n">trigger_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span>
                          <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="s1">'_autotrigger_value'</span><span class="p">)]</span>
        <span class="n">triggers</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">_autotrigger_value</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">trigger_params</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">}</span>

        <span class="n">events</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_events</span>
        <span class="n">watchers</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_watchers</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_events</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_watchers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">param_values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">get_param_values</span><span class="p">())</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">param_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">}</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_TRIGGER</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">triggers</span><span class="p">))</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_TRIGGER</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_events</span> <span class="o">+=</span> <span class="n">events</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_watchers</span> <span class="o">+=</span> <span class="n">watchers</span></div>


    <span class="k">def</span> <span class="nf">_update_event_type</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">watcher</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">triggered</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Returns an updated Event object with the type field set appropriately.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">triggered</span><span class="p">:</span>
            <span class="n">event_type</span> <span class="o">=</span> <span class="s1">'triggered'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event_type</span> <span class="o">=</span> <span class="s1">'changed'</span> <span class="k">if</span> <span class="n">watcher</span><span class="o">.</span><span class="n">onlychanged</span> <span class="k">else</span> <span class="s1">'set'</span>
        <span class="k">return</span> <span class="n">Event</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">what</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span>
                     <span class="n">old</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">new</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">event_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_watcher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">watcher</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">watcher</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">'args'</span><span class="p">:</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">events</span><span class="p">,</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="p">(),</span> <span class="p">{</span><span class="n">event</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">new</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">watcher</span><span class="o">.</span><span class="n">fn</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">async_executor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Could not execute </span><span class="si">%s</span><span class="s2"> coroutine function. "</span>
                                   <span class="s2">"Please register a asynchronous executor on "</span>
                                   <span class="s2">"param.parameterized.async_executor, which "</span>
                                   <span class="s2">"schedules the function on an event loop."</span> <span class="o">%</span>
                                   <span class="n">watcher</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>
            <span class="n">async_executor</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">watcher</span><span class="o">.</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">watcher</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_call_watcher</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">watcher</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Invoke the given the watcher appropriately given a Event object.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_TRIGGER</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">watcher</span><span class="o">.</span><span class="n">onlychanged</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">self_</span><span class="o">.</span><span class="n">_changed</span><span class="p">(</span><span class="n">event</span><span class="p">)):</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span><span class="p">:</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">watcher</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self_</span><span class="o">.</span><span class="n">_watchers</span><span class="p">:</span>
                <span class="n">self_</span><span class="o">.</span><span class="n">_watchers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">watcher</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_update_event_type</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_TRIGGER</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">batch_watch</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="n">watcher</span><span class="o">.</span><span class="n">queued</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">self_</span><span class="o">.</span><span class="n">_execute_watcher</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="p">(</span><span class="n">event</span><span class="p">,))</span>

    <span class="k">def</span> <span class="nf">_batch_call_watchers</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Batch call a set of watchers based on the parameter value</span>
<span class="sd">        settings in kwargs using the queued Event and watcher objects.</span>
<span class="sd">        """</span>
        <span class="k">while</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_events</span><span class="p">:</span>
            <span class="n">event_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([((</span><span class="n">event</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">what</span><span class="p">),</span> <span class="n">event</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_events</span><span class="p">])</span>
            <span class="n">watchers</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_watchers</span><span class="p">[:]</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_events</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_watchers</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">watcher</span> <span class="ow">in</span> <span class="n">watchers</span><span class="p">:</span>
                <span class="n">events</span> <span class="o">=</span> <span class="p">[</span><span class="n">self_</span><span class="o">.</span><span class="n">_update_event_type</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="n">event_dict</span><span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">watcher</span><span class="o">.</span><span class="n">what</span><span class="p">)],</span>
                                                   <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_TRIGGER</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">watcher</span><span class="o">.</span><span class="n">parameter_names</span>
                          <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">watcher</span><span class="o">.</span><span class="n">what</span><span class="p">)</span> <span class="ow">in</span> <span class="n">event_dict</span><span class="p">]</span>
                <span class="k">with</span> <span class="n">batch_watch</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="n">watcher</span><span class="o">.</span><span class="n">queued</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                    <span class="n">self_</span><span class="o">.</span><span class="n">_execute_watcher</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="n">events</span><span class="p">)</span>

<div class="viewcode-block" id="Parameters.set_dynamic_time_fn"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.set_dynamic_time_fn">[docs]</a>    <span class="k">def</span> <span class="nf">set_dynamic_time_fn</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">time_fn</span><span class="p">,</span><span class="n">sublistattr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Set time_fn for all Dynamic Parameters of this class or</span>
<span class="sd">        instance object that are currently being dynamically</span>
<span class="sd">        generated.</span>

<span class="sd">        Additionally, sets _Dynamic_time_fn=time_fn on this class or</span>
<span class="sd">        instance object, so that any future changes to Dynamic</span>
<span class="sd">        Parmeters can inherit time_fn (e.g. if a Number is changed</span>
<span class="sd">        from a float to a number generator, the number generator will</span>
<span class="sd">        inherit time_fn).</span>

<span class="sd">        If specified, sublistattr is the name of an attribute of this</span>
<span class="sd">        class or instance that contains an iterable collection of</span>
<span class="sd">        subobjects on which set_dynamic_time_fn should be called.  If</span>
<span class="sd">        the attribute sublistattr is present on any of the subobjects,</span>
<span class="sd">        set_dynamic_time_fn() will be called for those, too.</span>
<span class="sd">        """</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_Dynamic_time_fn</span> <span class="o">=</span> <span class="n">time_fn</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="n">self_or_cls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">self_or_cls</span><span class="p">,)</span>

        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">'existing'</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">'_value_is_dynamic'</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">_value_is_dynamic</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">):</span>
                    <span class="n">g</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_value_generator</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">_Dynamic_time_fn</span> <span class="o">=</span> <span class="n">time_fn</span>

        <span class="k">if</span> <span class="n">sublistattr</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sublist</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span><span class="n">sublistattr</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">sublist</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">set_dynamic_time_fn</span><span class="p">(</span><span class="n">time_fn</span><span class="p">,</span><span class="n">sublistattr</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">serialize_parameters</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'json'</span><span class="p">):</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Mode </span><span class="si">%r</span><span class="s1"> not in available serialization formats </span><span class="si">%r</span><span class="s1">'</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">serializer</span><span class="o">.</span><span class="n">serialize_parameters</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">serialize_value</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">pname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'json'</span><span class="p">):</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Mode </span><span class="si">%r</span><span class="s1"> not in available serialization formats </span><span class="si">%r</span><span class="s1">'</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">serializer</span><span class="o">.</span><span class="n">serialize_parameter_value</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">pname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">deserialize_parameters</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">serialization</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'json'</span><span class="p">):</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">serializer</span><span class="o">.</span><span class="n">deserialize_parameters</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">serialization</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">deserialize_value</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">pname</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'json'</span><span class="p">):</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Mode </span><span class="si">%r</span><span class="s1"> not in available serialization formats </span><span class="si">%r</span><span class="s1">'</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">serializer</span><span class="o">.</span><span class="n">deserialize_parameter_value</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">pname</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="Parameters.schema"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.schema">[docs]</a>    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'json'</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Returns a schema for the parameters on this Parameterized object.</span>
<span class="sd">        """</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Mode </span><span class="si">%r</span><span class="s1"> not in available serialization formats </span><span class="si">%r</span><span class="s1">'</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">serializer</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="n">safe</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.get_param_values"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.get_param_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_param_values</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">onlychanged</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return a list of name,value pairs for all Parameters of this</span>
<span class="sd">        object.</span>

<span class="sd">        When called on an instance with onlychanged set to True, will</span>
<span class="sd">        only return values that are not equal to the default value</span>
<span class="sd">        (onlychanged has no effect when called on a class).</span>
<span class="sd">        """</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="c1"># CEB: we'd actually like to know whether a value has been</span>
        <span class="c1"># explicitly set on the instance, but I'm not sure that's easy</span>
        <span class="c1"># (would need to distinguish instantiation of default from</span>
        <span class="c1"># user setting of value).</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">'existing'</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_value_generator</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="c1"># (this is pointless for cls)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">onlychanged</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">all_equal</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">default</span><span class="p">):</span>
                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="n">vals</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">vals</span></div>


<div class="viewcode-block" id="Parameters.force_new_dynamic_value"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.force_new_dynamic_value">[docs]</a>    <span class="k">def</span> <span class="nf">force_new_dynamic_value</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span> <span class="c1"># pylint: disable-msg=E0213</span>
        <span class="sd">"""</span>
<span class="sd">        Force a new value to be generated for the dynamic attribute</span>
<span class="sd">        name, and return it.</span>

<span class="sd">        If name is not dynamic, its current value is returned</span>
<span class="sd">        (i.e. equivalent to getattr(name).</span>
<span class="sd">        """</span>
        <span class="n">cls_or_slf</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="n">param_obj</span> <span class="o">=</span> <span class="n">cls_or_slf</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">'existing'</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">param_obj</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="bp">cls</span><span class="p">,</span> <span class="n">slf</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">cls_or_slf</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slf</span> <span class="o">=</span> <span class="n">cls_or_slf</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">param_obj</span><span class="p">,</span><span class="s1">'_force'</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">param_obj</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">slf</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">_force</span><span class="p">(</span><span class="n">slf</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parameters.get_value_generator"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.get_value_generator">[docs]</a>    <span class="k">def</span> <span class="nf">get_value_generator</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">name</span><span class="p">):</span> <span class="c1"># pylint: disable-msg=E0213</span>
        <span class="sd">"""</span>
<span class="sd">        Return the value or value-generating object of the named</span>
<span class="sd">        attribute.</span>

<span class="sd">        For most parameters, this is simply the parameter's value</span>
<span class="sd">        (i.e. the same as getattr()), but Dynamic parameters have</span>
<span class="sd">        their value-generating object returned.</span>
<span class="sd">        """</span>
        <span class="n">cls_or_slf</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="n">param_obj</span> <span class="o">=</span> <span class="n">cls_or_slf</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">'existing'</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">param_obj</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># CompositeParameter detected by being a Parameter and having 'attribs'</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">param_obj</span><span class="p">,</span><span class="s1">'attribs'</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">cls_or_slf</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_value_generator</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">attribs</span><span class="p">]</span>

        <span class="c1"># not a Dynamic Parameter</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">param_obj</span><span class="p">,</span><span class="s1">'_value_is_dynamic'</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Dynamic Parameter...</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">internal_name</span> <span class="o">=</span> <span class="s2">"_</span><span class="si">%s</span><span class="s2">_param_value"</span><span class="o">%</span><span class="n">name</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="n">internal_name</span><span class="p">):</span>
                <span class="c1"># dealing with object and it's been set on this object</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="n">internal_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># dealing with class or isn't set on the object</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">default</span>

        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Parameters.inspect_value"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.inspect_value">[docs]</a>    <span class="k">def</span> <span class="nf">inspect_value</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">name</span><span class="p">):</span> <span class="c1"># pylint: disable-msg=E0213</span>
        <span class="sd">"""</span>
<span class="sd">        Return the current value of the named attribute without modifying it.</span>

<span class="sd">        Same as getattr() except for Dynamic parameters, which have their</span>
<span class="sd">        last generated value returned.</span>
<span class="sd">        """</span>
        <span class="n">cls_or_slf</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="n">param_obj</span> <span class="o">=</span> <span class="n">cls_or_slf</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">'existing'</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">param_obj</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">param_obj</span><span class="p">,</span><span class="s1">'attribs'</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">cls_or_slf</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">inspect_value</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">attribs</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">param_obj</span><span class="p">,</span><span class="s1">'_inspect'</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">_inspect</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="n">cls_or_slf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">_inspect</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></div>


    <span class="k">def</span> <span class="nf">params_depended_on</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_params_depended_on</span><span class="p">(</span><span class="n">MInfo</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="n">inst</span><span class="o">=</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="p">,</span><span class="n">name</span><span class="p">)))</span>


<div class="viewcode-block" id="Parameters.outputs"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.outputs">[docs]</a>    <span class="k">def</span> <span class="nf">outputs</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Returns a mapping between any declared outputs and a tuple</span>
<span class="sd">        of the declared Parameter type, the output method, and the</span>
<span class="sd">        index into the output if multiple outputs are returned.</span>
<span class="sd">        """</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">classlist</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
                <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">dinfo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s1">'_dinfo'</span><span class="p">,</span> <span class="p">{})</span>
                <span class="k">if</span> <span class="s1">'outputs'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dinfo</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">override</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">dinfo</span><span class="p">[</span><span class="s1">'outputs'</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">override</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">override</span>
                    <span class="n">outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">otype</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>


    <span class="k">def</span> <span class="nf">_spec_to_obj</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">spec</span><span class="p">):</span>
        <span class="c1"># TODO: when we decide on spec, this method should be</span>
        <span class="c1"># rewritten</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">owner</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">owner</span> <span class="k">if</span> <span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">type</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">PInfo</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">inst</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                         <span class="n">pobj</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s1">'value'</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">info</span><span class="p">]</span>

        <span class="k">assert</span> <span class="n">spec</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">":"</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span>

        <span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">"(?P&lt;path&gt;[^:]*):?(?P&lt;what&gt;.*)"</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="n">what</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">'what'</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">"."</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">'path'</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">"(?P&lt;obj&gt;.*)(\.)(?P&lt;attr&gt;.*)"</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">'obj'</span><span class="p">)</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">"attr"</span><span class="p">)</span>

        <span class="n">src</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span> <span class="k">if</span> <span class="n">obj</span><span class="o">==</span><span class="s1">''</span> <span class="k">else</span> <span class="n">_getattrr</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="p">,</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">::])</span>
        <span class="bp">cls</span><span class="p">,</span><span class="n">inst</span> <span class="o">=</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">src</span><span class="p">),</span> <span class="n">src</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">'param'</span><span class="p">:</span>
            <span class="n">dependencies</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_spec_to_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">param</span><span class="p">:</span>
                <span class="n">dependencies</span> <span class="o">+=</span> <span class="n">src</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_spec_to_obj</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dependencies</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">param</span><span class="p">:</span>
            <span class="n">what</span> <span class="o">=</span> <span class="n">what</span> <span class="k">if</span> <span class="n">what</span> <span class="o">!=</span> <span class="s1">''</span> <span class="k">else</span> <span class="s1">'value'</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">PInfo</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">inst</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">attr</span><span class="p">,</span>
                         <span class="n">pobj</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="n">what</span><span class="o">=</span><span class="n">what</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">MInfo</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">inst</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">attr</span><span class="p">,</span>
                         <span class="n">method</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">attr</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">info</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">_watch</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">watcher</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s1">'value'</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">'add'</span><span class="p">):</span> <span class="c1">#'add' | 'remove'</span>
        <span class="n">parameter_names</span> <span class="o">=</span> <span class="n">watcher</span><span class="o">.</span><span class="n">parameter_names</span>
        <span class="k">for</span> <span class="n">parameter_name</span> <span class="ow">in</span> <span class="n">parameter_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parameter_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">param</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2"> parameter was not found in list of "</span>
                                 <span class="s2">"parameters of class </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">parameter_name</span><span class="p">,</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">what</span> <span class="o">==</span> <span class="s2">"value"</span><span class="p">:</span>
                <span class="n">watchers</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param_watchers</span>
                <span class="k">if</span> <span class="n">parameter_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">watchers</span><span class="p">:</span>
                    <span class="n">watchers</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">what</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">watchers</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]:</span>
                    <span class="n">watchers</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">][</span><span class="n">what</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">watchers</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">][</span><span class="n">what</span><span class="p">],</span> <span class="n">action</span><span class="p">)(</span><span class="n">watcher</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">watchers</span> <span class="o">=</span> <span class="n">self_</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span><span class="o">.</span><span class="n">watchers</span>
                <span class="k">if</span> <span class="n">what</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">watchers</span><span class="p">:</span>
                    <span class="n">watchers</span><span class="p">[</span><span class="n">what</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">watchers</span><span class="p">[</span><span class="n">what</span><span class="p">],</span> <span class="n">action</span><span class="p">)(</span><span class="n">watcher</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">watch</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">parameter_names</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s1">'value'</span><span class="p">,</span> <span class="n">onlychanged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">queued</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">parameter_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">parameter_names</span><span class="p">,)</span>
        <span class="n">watcher</span> <span class="o">=</span> <span class="n">Watcher</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'args'</span><span class="p">,</span>
                          <span class="n">onlychanged</span><span class="o">=</span><span class="n">onlychanged</span><span class="p">,</span> <span class="n">parameter_names</span><span class="o">=</span><span class="n">parameter_names</span><span class="p">,</span>
                          <span class="n">what</span><span class="o">=</span><span class="n">what</span><span class="p">,</span> <span class="n">queued</span><span class="o">=</span><span class="n">queued</span><span class="p">)</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">_watch</span><span class="p">(</span><span class="s1">'append'</span><span class="p">,</span> <span class="n">watcher</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">watcher</span>

<div class="viewcode-block" id="Parameters.unwatch"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.unwatch">[docs]</a>    <span class="k">def</span> <span class="nf">unwatch</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">watcher</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Unwatch watchers set either with watch or watch_values.</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">_watch</span><span class="p">(</span><span class="s1">'remove'</span><span class="p">,</span><span class="n">watcher</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'No such watcher </span><span class="si">{watcher}</span><span class="s1"> to remove.'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">watcher</span><span class="o">=</span><span class="n">watcher</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="nf">watch_values</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">parameter_names</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s1">'value'</span><span class="p">,</span> <span class="n">onlychanged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">queued</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">parameter_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">parameter_names</span><span class="p">,)</span>
        <span class="n">watcher</span> <span class="o">=</span> <span class="n">Watcher</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span>
                          <span class="n">mode</span><span class="o">=</span><span class="s1">'kwargs'</span><span class="p">,</span> <span class="n">onlychanged</span><span class="o">=</span><span class="n">onlychanged</span><span class="p">,</span>
                          <span class="n">parameter_names</span><span class="o">=</span><span class="n">parameter_names</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s1">'value'</span><span class="p">,</span>
                          <span class="n">queued</span><span class="o">=</span><span class="n">queued</span><span class="p">)</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">_watch</span><span class="p">(</span><span class="s1">'append'</span><span class="p">,</span> <span class="n">watcher</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">watcher</span>


    <span class="c1"># Instance methods</span>


<div class="viewcode-block" id="Parameters.defaults"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.defaults">[docs]</a>    <span class="k">def</span> <span class="nf">defaults</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return {parameter_name:parameter.default} for all non-constant</span>
<span class="sd">        Parameters.</span>

<span class="sd">        Note that a Parameter for which instantiate==True has its default</span>
<span class="sd">        instantiated.</span>
<span class="sd">        """</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">'existing'</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">instantiate</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_instantiate_param</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">dict_</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">param_name</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span>
        <span class="k">return</span> <span class="n">d</span></div>

    <span class="c1"># CEBALERT: designed to avoid any processing unless the print</span>
    <span class="c1"># level is high enough, but not all callers of message(),</span>
    <span class="c1"># verbose(), debug(), etc are taking advantage of this. Need to</span>
    <span class="c1"># document, and also check other ioam projects.</span>
    <span class="k">def</span> <span class="nf">__db_print</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Calls the logger returned by the get_logger() function,</span>
<span class="sd">        prepending the result of calling dbprint_prefix() (if any).</span>

<span class="sd">        See python's logging module for details.</span>
<span class="sd">        """</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">dbprint_prefix</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="n">dbprint_prefix</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">dbprint_prefix</span><span class="p">()</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="n">msg</span>  <span class="c1"># pylint: disable-msg=E1102</span>

            <span class="n">get_logger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="Parameters.print_param_values"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.print_param_values">[docs]</a>    <span class="k">def</span> <span class="nf">print_param_values</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="sd">"""Print the values of all this object's Parameters."""</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_param_values</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">))</span></div>

<div class="viewcode-block" id="Parameters.warning"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.warning">[docs]</a>    <span class="k">def</span> <span class="nf">warning</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Print msg merged with args as a warning, unless module variable</span>
<span class="sd">        warnings_as_exceptions is True, then raise an Exception</span>
<span class="sd">        containing the arguments.</span>

<span class="sd">        See Python's logging module for details of message formatting.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">warnings_as_exceptions</span><span class="p">:</span>
            <span class="k">global</span> <span class="n">warning_count</span>
            <span class="n">warning_count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">__db_print</span><span class="p">(</span><span class="n">WARNING</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Warning: "</span> <span class="o">+</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.message"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.message">[docs]</a>    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Print msg merged with args as a message.</span>

<span class="sd">        See Python's logging module for details of message formatting.</span>
<span class="sd">        """</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">__db_print</span><span class="p">(</span><span class="n">INFO</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.verbose"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.verbose">[docs]</a>    <span class="k">def</span> <span class="nf">verbose</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Print msg merged with args as a verbose message.</span>

<span class="sd">        See Python's logging module for details of message formatting.</span>
<span class="sd">        """</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">__db_print</span><span class="p">(</span><span class="n">VERBOSE</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.debug"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameters.debug">[docs]</a>    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Print msg merged with args as a debugging statement.</span>

<span class="sd">        See Python's logging module for details of message formatting.</span>
<span class="sd">        """</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">__db_print</span><span class="p">(</span><span class="n">DEBUG</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span></div></div>


    <span class="c1"># CEBALERT: I think I've noted elsewhere the fact that we</span>
    <span class="c1"># sometimes have a method on Parameter that requires passing the</span>
    <span class="c1"># owning Parameterized instance or class, and other times we have</span>
    <span class="c1"># the method on Parameterized itself.  In case I haven't written</span>
    <span class="c1"># that down elsewhere, here it is again.  We should clean that up</span>
    <span class="c1"># (at least we should be consistent).</span>

    <span class="c1"># cebalert: it's really time to stop and clean up this bothmethod</span>
    <span class="c1"># stuff and repeated code in methods using it.</span>



<div class="viewcode-block" id="ParameterizedMetaclass"><a class="viewcode-back" href="../../reference.html#param.__init__.ParameterizedMetaclass">[docs]</a><span class="k">class</span> <span class="nc">ParameterizedMetaclass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    The metaclass of Parameterized (and all its descendents).</span>

<span class="sd">    The metaclass overrides type.__setattr__ to allow us to set</span>
<span class="sd">    Parameter values on classes without overwriting the attribute</span>
<span class="sd">    descriptor.  That is, for a Parameterized class of type X with a</span>
<span class="sd">    Parameter y, the user can type X.y=3, which sets the default value</span>
<span class="sd">    of Parameter y to be 3, rather than overwriting y with the</span>
<span class="sd">    constant value 3 (and thereby losing all other info about that</span>
<span class="sd">    Parameter, such as the doc string, bounds, etc.).</span>

<span class="sd">    The __init__ method is used when defining a Parameterized class,</span>
<span class="sd">    usually when the module where that class is located is imported</span>
<span class="sd">    for the first time.  That is, the __init__ in this metaclass</span>
<span class="sd">    initializes the *class* object, while the __init__ method defined</span>
<span class="sd">    in each Parameterized class is called for each new instance of</span>
<span class="sd">    that class.</span>

<span class="sd">    Additionally, a class can declare itself abstract by having an</span>
<span class="sd">    attribute __abstract set to True. The 'abstract' attribute can be</span>
<span class="sd">    used to find out if a class is abstract or not.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">bases</span><span class="p">,</span><span class="n">dict_</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Initialize the class object (not an instance of the class, but</span>
<span class="sd">        the class itself).</span>

<span class="sd">        Initializes all the Parameters by looking up appropriate</span>
<span class="sd">        default values (see __param_inheritance()) and setting</span>
<span class="sd">        attrib_names (see _set_names()).</span>
<span class="sd">        """</span>
        <span class="nb">type</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">bases</span><span class="p">,</span><span class="n">dict_</span><span class="p">)</span>

        <span class="c1"># Give Parameterized classes a useful 'name' attribute.</span>
        <span class="c1"># (Could instead consider changing the instance Parameter</span>
        <span class="c1"># 'name' to '__name__'?)</span>
        <span class="n">mcs</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="n">mcs</span><span class="o">.</span><span class="n">_parameters_state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"BATCH_WATCH"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># If true, Event and watcher objects are queued.</span>
            <span class="s2">"TRIGGER"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">"events"</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># Queue of batched events</span>
            <span class="s2">"watchers"</span><span class="p">:</span> <span class="p">[]</span> <span class="c1"># Queue of batched watchers</span>
        <span class="p">}</span>
        <span class="n">mcs</span><span class="o">.</span><span class="n">_param</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span><span class="n">mcs</span><span class="p">)</span>

        <span class="c1"># All objects (with their names) of type Parameter that are</span>
        <span class="c1"># defined in this class</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[(</span><span class="n">n</span><span class="p">,</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">o</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dict_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">)]</span>

        <span class="n">mcs</span><span class="o">.</span><span class="n">_param</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span><span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">mcs</span><span class="o">.</span><span class="n">_initialize_parameter</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span><span class="n">param</span><span class="p">)</span>

        <span class="c1"># retrieve depends info from methods and store more conveniently</span>
        <span class="n">dependers</span> <span class="o">=</span> <span class="p">[(</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">_dinfo</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dict_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                     <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="s1">'_dinfo'</span><span class="p">)]</span>

        <span class="n">_watch</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># TODO: probably copy dependencies here too and have</span>
        <span class="c1"># everything else access from here rather than from method</span>
        <span class="c1"># object</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">dinfo</span> <span class="ow">in</span> <span class="n">dependers</span><span class="p">:</span>
            <span class="n">watch</span> <span class="o">=</span> <span class="n">dinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'watch'</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">watch</span><span class="p">:</span>
                <span class="n">_watch</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">watch</span> <span class="o">==</span> <span class="s1">'queued'</span><span class="p">))</span>

        <span class="n">mcs</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_depends</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'watch'</span><span class="p">:</span> <span class="n">_watch</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">docstring_signature</span><span class="p">:</span>
            <span class="n">mcs</span><span class="o">.</span><span class="n">__class_docstring_signature</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__class_docstring_signature</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">max_repr_len</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Autogenerate a keyword signature in the class docstring for</span>
<span class="sd">        all available parameters. This is particularly useful in the</span>
<span class="sd">        IPython Notebook as IPython will parse this signature to allow</span>
<span class="sd">        tab-completion of keywords.</span>

<span class="sd">        max_repr_len: Maximum length (in characters) of value reprs.</span>
<span class="sd">        """</span>
        <span class="n">processed_kws</span><span class="p">,</span> <span class="n">keyword_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">mcs</span><span class="o">.</span><span class="n">mro</span><span class="p">()):</span>
            <span class="n">keyword_group</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">processed_kws</span><span class="p">:</span>
                    <span class="n">param_type</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                    <span class="n">keyword_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">param_type</span><span class="p">))</span>
                    <span class="n">processed_kws</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">keyword_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">keyword_group</span><span class="p">)</span>

        <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">grp</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">keyword_groups</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">grp</span><span class="p">]</span>
        <span class="n">class_docstr</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">+</span><span class="n">mcs</span><span class="o">.</span><span class="vm">__doc__</span> <span class="k">if</span> <span class="n">mcs</span><span class="o">.</span><span class="vm">__doc__</span> <span class="k">else</span> <span class="s1">''</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="s2">"params(</span><span class="si">%s</span><span class="s2">)"</span> <span class="o">%</span> <span class="p">(</span><span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keywords</span><span class="p">))</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">param_pager</span><span class="p">(</span><span class="n">mcs</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">docstring_describe_params</span> <span class="ow">and</span> <span class="n">param_pager</span><span class="p">)</span> <span class="k">else</span> <span class="s1">''</span>
        <span class="n">mcs</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">signature</span> <span class="o">+</span> <span class="n">class_docstr</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="o">+</span> <span class="n">description</span>


    <span class="k">def</span> <span class="nf">_initialize_parameter</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">param_name</span><span class="p">,</span><span class="n">param</span><span class="p">):</span>
        <span class="c1"># parameter has no way to find out the name a</span>
        <span class="c1"># Parameterized class has for it</span>
        <span class="n">param</span><span class="o">.</span><span class="n">_set_names</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span>
        <span class="n">mcs</span><span class="o">.</span><span class="n">__param_inheritance</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span><span class="n">param</span><span class="p">)</span>


    <span class="c1"># Python 2.6 added abstract base classes; see</span>
    <span class="c1"># https://github.com/ioam/param/issues/84</span>
    <span class="k">def</span> <span class="nf">__is_abstract</span><span class="p">(</span><span class="n">mcs</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return True if the class has an attribute __abstract set to True.</span>
<span class="sd">        Subclasses will return False unless they themselves have</span>
<span class="sd">        __abstract set to true.  This mechanism allows a class to</span>
<span class="sd">        declare itself to be abstract (e.g. to avoid it being offered</span>
<span class="sd">        as an option in a GUI), without the "abstract" property being</span>
<span class="sd">        inherited by its subclasses (at least one of which is</span>
<span class="sd">        presumably not abstract).</span>
<span class="sd">        """</span>
        <span class="c1"># Can't just do ".__abstract", because that is mangled to</span>
        <span class="c1"># _ParameterizedMetaclass__abstract before running, but</span>
        <span class="c1"># the actual class object will have an attribute</span>
        <span class="c1"># _ClassName__abstract.  So, we have to mangle it ourselves at</span>
        <span class="c1"># runtime. Mangling follows description in https://docs.python.org/2/tutorial/classes.html#private-variables-and-class-local-references</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="s1">'_</span><span class="si">%s</span><span class="s1">__abstract'</span><span class="o">%</span><span class="n">mcs</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">"_"</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="n">abstract</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">__is_abstract</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_param</span><span class="p">(</span><span class="n">mcs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mcs</span><span class="o">.</span><span class="n">_param</span>

    <span class="n">param</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_param</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">attribute_name</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Implements 'self.attribute_name=value' in a way that also supports Parameters.</span>

<span class="sd">        If there is already a descriptor named attribute_name, and</span>
<span class="sd">        that descriptor is a Parameter, and the new value is *not* a</span>
<span class="sd">        Parameter, then call that Parameter's __set__ method with the</span>
<span class="sd">        specified value.</span>

<span class="sd">        In all other cases set the attribute normally (i.e. overwrite</span>
<span class="sd">        the descriptor).  If the new value is a Parameter, once it has</span>
<span class="sd">        been set we make sure that the value is inherited from</span>
<span class="sd">        Parameterized superclasses as described in __param_inheritance().</span>
<span class="sd">        """</span>
        <span class="c1"># Find out if there's a Parameter called attribute_name as a</span>
        <span class="c1"># class attribute of this class - if not, parameter is None.</span>
        <span class="n">parameter</span><span class="p">,</span><span class="n">owning_class</span> <span class="o">=</span> <span class="n">mcs</span><span class="o">.</span><span class="n">get_param_descriptor</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parameter</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">Parameter</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">owning_class</span> <span class="o">!=</span> <span class="n">mcs</span><span class="p">:</span>
                <span class="n">parameter</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
                <span class="n">parameter</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">mcs</span>
                <span class="nb">type</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">attribute_name</span><span class="p">,</span><span class="n">parameter</span><span class="p">)</span>
            <span class="n">mcs</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">type</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">attribute_name</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">Parameter</span><span class="p">):</span>
                <span class="n">mcs</span><span class="o">.</span><span class="n">__param_inheritance</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">Parameters</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># the purpose of the warning below is to catch</span>
                <span class="c1"># mistakes ("thinking you are setting a parameter, but</span>
                <span class="c1"># you're not"). There are legitimate times when</span>
                <span class="c1"># something needs be set on the class, and we don't</span>
                <span class="c1"># want to see a warning then. Such attributes should</span>
                <span class="c1"># presumably be prefixed by at least one underscore.</span>
                <span class="c1"># (For instance, python's own pickling mechanism</span>
                <span class="c1"># caches __slotnames__ on the class:</span>
                <span class="c1"># http://mail.python.org/pipermail/python-checkins/2003-February/033517.html.)</span>
                <span class="c1"># CEBALERT: this warning bypasses the usual</span>
                <span class="c1"># mechanisms, which has have consequences for warning</span>
                <span class="c1"># counts, warnings as exceptions, etc.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">attribute_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'_'</span><span class="p">):</span>
                    <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">WARNING</span><span class="p">,</span>
                                     <span class="s2">"Setting non-Parameter class attribute </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2"> "</span><span class="p">,</span>
                                     <span class="n">mcs</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">attribute_name</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">__param_inheritance</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">param_name</span><span class="p">,</span><span class="n">param</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Look for Parameter values in superclasses of this</span>
<span class="sd">        Parameterized class.</span>

<span class="sd">        Ordinarily, when a Python object is instantiated, attributes</span>
<span class="sd">        not given values in the constructor will inherit the value</span>
<span class="sd">        given in the object's class, or in its superclasses.  For</span>
<span class="sd">        Parameters owned by Parameterized classes, we have implemented</span>
<span class="sd">        an additional level of default lookup, should this ordinary</span>
<span class="sd">        lookup return only None.</span>

<span class="sd">        In such a case, i.e. when no non-None value was found for a</span>
<span class="sd">        Parameter by the usual inheritance mechanisms, we explicitly</span>
<span class="sd">        look for Parameters with the same name in superclasses of this</span>
<span class="sd">        Parameterized class, and use the first such value that we</span>
<span class="sd">        find.</span>

<span class="sd">        The goal is to be able to set the default value (or other</span>
<span class="sd">        slots) of a Parameter within a Parameterized class, just as we</span>
<span class="sd">        can set values for non-Parameter objects in Parameterized</span>
<span class="sd">        classes, and have the values inherited through the</span>
<span class="sd">        Parameterized hierarchy as usual.</span>

<span class="sd">        Note that instantiate is handled differently: if there is a</span>
<span class="sd">        parameter with the same name in one of the superclasses with</span>
<span class="sd">        instantiate set to True, this parameter will inherit</span>
<span class="sd">        instantiate=True.</span>
<span class="sd">        """</span>
        <span class="c1"># get all relevant slots (i.e. slots defined in all</span>
        <span class="c1"># superclasses of this parameter)</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">p_class</span> <span class="ow">in</span> <span class="n">classlist</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">))[</span><span class="mi">1</span><span class="p">::]:</span>
            <span class="n">slots</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">p_class</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">))</span>


        <span class="c1"># note for some eventual future: python 3.6+ descriptors grew</span>
        <span class="c1"># __set_name__, which could replace this and _set_names</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="s1">'owner'</span><span class="p">,</span><span class="n">mcs</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">slots</span><span class="p">[</span><span class="s1">'owner'</span><span class="p">]</span>

        <span class="c1"># backwards compatibility (see Composite parameter)</span>
        <span class="k">if</span> <span class="s1">'objtype'</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="s1">'objtype'</span><span class="p">,</span><span class="n">mcs</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">slots</span><span class="p">[</span><span class="s1">'objtype'</span><span class="p">]</span>

        <span class="c1"># instantiate is handled specially</span>
        <span class="k">for</span> <span class="n">superclass</span> <span class="ow">in</span> <span class="n">classlist</span><span class="p">(</span><span class="n">mcs</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">super_param</span> <span class="o">=</span> <span class="n">superclass</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">super_param</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">)</span> <span class="ow">and</span> <span class="n">super_param</span><span class="o">.</span><span class="n">instantiate</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">param</span><span class="o">.</span><span class="n">instantiate</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">del</span> <span class="n">slots</span><span class="p">[</span><span class="s1">'instantiate'</span><span class="p">]</span>


        <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">slots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">superclasses</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">classlist</span><span class="p">(</span><span class="n">mcs</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Search up the hierarchy until param.slot (which has to</span>
            <span class="c1"># be obtained using getattr(param,slot)) is not None, or</span>
            <span class="c1"># we run out of classes to search.</span>
            <span class="k">while</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="n">slot</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">param_super_class</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">superclasses</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="n">new_param</span> <span class="o">=</span> <span class="n">param_super_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_param</span><span class="p">,</span><span class="n">slot</span><span class="p">):</span>
                    <span class="c1"># (slot might not be there because could be a more</span>
                    <span class="c1"># general type of Parameter)</span>
                    <span class="n">new_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_param</span><span class="p">,</span><span class="n">slot</span><span class="p">)</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="n">slot</span><span class="p">,</span><span class="n">new_value</span><span class="p">)</span>


<div class="viewcode-block" id="ParameterizedMetaclass.get_param_descriptor"><a class="viewcode-back" href="../../reference.html#param.__init__.ParameterizedMetaclass.get_param_descriptor">[docs]</a>    <span class="k">def</span> <span class="nf">get_param_descriptor</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">param_name</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Goes up the class hierarchy (starting from the current class)</span>
<span class="sd">        looking for a Parameter class attribute param_name. As soon as</span>
<span class="sd">        one is found as a class attribute, that Parameter is returned</span>
<span class="sd">        along with the class in which it is declared.</span>
<span class="sd">        """</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="n">classlist</span><span class="p">(</span><span class="n">mcs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span><span class="n">Parameter</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">attribute</span><span class="p">,</span><span class="n">c</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span></div></div>




<span class="c1"># JABALERT: Only partially achieved so far -- objects of the same</span>
<span class="c1"># type and parameter values are treated as different, so anything</span>
<span class="c1"># for which instantiate == True is reported as being non-default.</span>

<span class="c1"># Whether script_repr should avoid reporting the values of parameters</span>
<span class="c1"># that are just inheriting their values from the class defaults.</span>
<span class="n">script_repr_suppress_defaults</span><span class="o">=</span><span class="kc">True</span>


<span class="c1"># CEBALERT: How about some defaults?</span>
<span class="c1"># Also, do we need an option to return repr without path, if desired?</span>
<span class="c1"># E.g. to get 'pre_plot_hooks()' instead of</span>
<span class="c1"># 'topo.command.analysis.pre_plot_hooks()' in the gui?</span>
<div class="viewcode-block" id="script_repr"><a class="viewcode-back" href="../../reference.html#param.__init__.script_repr">[docs]</a><span class="k">def</span> <span class="nf">script_repr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Variant of repr() designed for generating a runnable script.</span>

<span class="sd">    Instances of types that require special handling can use the</span>
<span class="sd">    script_repr_reg dictionary. Using the type as a key, add a</span>
<span class="sd">    function that returns a suitable representation of instances of</span>
<span class="sd">    that type, and adds the required import statement.</span>

<span class="sd">    The repr of a parameter can be suppressed by returning None from</span>
<span class="sd">    the appropriate hook in script_repr_reg.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">pprint</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">,</span><span class="n">unknown_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">qualify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">separator</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></div>


<span class="c1"># CB: when removing script_repr, merge its docstring here and improve.</span>
<span class="c1"># And the ALERT by script_repr about defaults can go.</span>
<span class="c1"># CEBALERT: remove settings, add default argument for imports</span>
<div class="viewcode-block" id="pprint"><a class="viewcode-back" href="../../reference.html#param.__init__.pprint">[docs]</a><span class="k">def</span> <span class="nf">pprint</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">    "</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">[],</span>
           <span class="n">unknown_value</span><span class="o">=</span><span class="s1">'&lt;?&gt;'</span><span class="p">,</span> <span class="n">qualify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">''</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    (Experimental) Pretty printed representation of a parameterized</span>
<span class="sd">    object that may be evaluated with eval.</span>

<span class="sd">    Similar to repr except introspection of the constructor (__init__)</span>
<span class="sd">    ensures a valid and succinct representation is generated.</span>

<span class="sd">    Only parameters are represented (whether specified as standard,</span>
<span class="sd">    positional, or keyword arguments). Parameters specified as</span>
<span class="sd">    positional arguments are always shown, followed by modified</span>
<span class="sd">    parameters specified as keyword arguments, sorted by precedence.</span>

<span class="sd">    unknown_value determines what to do where a representation cannot be</span>
<span class="sd">    generated for something required to recreate the object. Such things</span>
<span class="sd">    include non-parameter positional and keyword arguments, and certain</span>
<span class="sd">    values of parameters (e.g. some random state objects).</span>

<span class="sd">    Supplying an unknown_value of None causes unrepresentable things</span>
<span class="sd">    to be silently ignored. If unknown_value is a string, that</span>
<span class="sd">    string will appear in place of any unrepresentable things. If</span>
<span class="sd">    unknown_value is False, an Exception will be raised if an</span>
<span class="sd">    unrepresentable value is encountered.</span>

<span class="sd">    If supplied, imports should be a list, and it will be populated</span>
<span class="sd">    with the set of imports required for the object and all of its</span>
<span class="sd">    parameter values.</span>

<span class="sd">    If qualify is True, the class's path will be included (e.g. "a.b.C()"),</span>
<span class="sd">    otherwise only the class will appear ("C()").</span>

<span class="sd">    Parameters will be separated by a comma only by default, but the</span>
<span class="sd">    separator parameter allows an additional separator to be supplied</span>
<span class="sd">    (e.g. a newline could be supplied to have each Parameter appear on a</span>
<span class="sd">    separate line).</span>

<span class="sd">    NOTE: pprint will replace script_repr in a future version of</span>
<span class="sd">    param, but is not yet a complete replacement for script_repr.</span>
<span class="sd">    """</span>
    <span class="c1"># CB: doc prefix &amp; settings or realize they don't need to be</span>
    <span class="c1"># passed around, etc.</span>
    <span class="c1"># JLS: The settings argument is not used anywhere. To be removed</span>
    <span class="c1"># in a separate PR.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="n">type_script_repr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">script_repr_reg</span><span class="p">:</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="n">script_repr_reg</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)](</span><span class="n">val</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">)</span>

    <span class="c1"># CEBALERT: remove with script_repr</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="s1">'script_repr'</span><span class="p">):</span>
        <span class="n">rep</span><span class="o">=</span><span class="n">val</span><span class="o">.</span><span class="n">script_repr</span><span class="p">(</span><span class="n">imports</span><span class="p">,</span> <span class="n">prefix</span><span class="o">+</span><span class="s2">"    "</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="s1">'pprint'</span><span class="p">):</span>
        <span class="n">rep</span><span class="o">=</span><span class="n">val</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">imports</span><span class="o">=</span><span class="n">imports</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="o">+</span><span class="s2">"    "</span><span class="p">,</span>
                       <span class="n">qualify</span><span class="o">=</span><span class="n">qualify</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=</span><span class="n">unknown_value</span><span class="p">,</span>
                       <span class="n">separator</span><span class="o">=</span><span class="n">separator</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">rep</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rep</span></div>


<span class="c1">#: see script_repr()</span>
<span class="n">script_repr_reg</span> <span class="o">=</span> <span class="p">{}</span>


<span class="c1"># currently only handles list and tuple</span>
<span class="k">def</span> <span class="nf">container_script_repr</span><span class="p">(</span><span class="n">container</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">):</span>
    <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">container</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pprint</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">))</span>

    <span class="c1">## (hack to get container brackets)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">container</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="o">=</span><span class="s1">'['</span><span class="p">,</span><span class="s1">']'</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">container</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span>
        <span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="o">=</span><span class="s1">'('</span><span class="p">,</span><span class="s1">')'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="n">rep</span><span class="o">=</span><span class="n">d1</span><span class="o">+</span><span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">+</span><span class="n">d2</span>

    <span class="c1"># no imports to add for built-in types</span>

    <span class="k">return</span> <span class="n">rep</span>


<span class="k">def</span> <span class="nf">empty_script_repr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span> <span class="c1"># pyflakes:ignore (unused arguments):</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Suppress scriptrepr for objects not yet having a useful string representation</span>
    <span class="kn">import</span> <span class="nn">numpy</span>
    <span class="n">script_repr_reg</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty_script_repr</span>
    <span class="n">script_repr_reg</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty_script_repr</span>

<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c1"># Support added only if those libraries are available</span>


<span class="c1"># why I have to type prefix and settings?</span>
<span class="k">def</span> <span class="nf">function_script_repr</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__module__</span>
    <span class="n">imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'import </span><span class="si">%s</span><span class="s1">'</span><span class="o">%</span><span class="n">module</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">module</span><span class="o">+</span><span class="s1">'.'</span><span class="o">+</span><span class="n">name</span>

<span class="k">def</span> <span class="nf">type_script_repr</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">):</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">type_</span><span class="o">.</span><span class="vm">__module__</span>
    <span class="k">if</span> <span class="n">module</span><span class="o">!=</span><span class="s1">'__builtin__'</span><span class="p">:</span>
        <span class="n">imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'import </span><span class="si">%s</span><span class="s1">'</span><span class="o">%</span><span class="n">module</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">module</span><span class="o">+</span><span class="s1">'.'</span><span class="o">+</span><span class="n">type_</span><span class="o">.</span><span class="vm">__name__</span>

<span class="n">script_repr_reg</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span><span class="o">=</span><span class="n">container_script_repr</span>
<span class="n">script_repr_reg</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span><span class="o">=</span><span class="n">container_script_repr</span>
<span class="n">script_repr_reg</span><span class="p">[</span><span class="n">FunctionType</span><span class="p">]</span><span class="o">=</span><span class="n">function_script_repr</span>


<span class="c1">#: If not None, the value of this Parameter will be called (using '()')</span>
<span class="c1">#: before every call to __db_print, and is expected to evaluate to a</span>
<span class="c1">#: string that is suitable for prefixing messages and warnings (such</span>
<span class="c1">#: as some indicator of the global state).</span>
<span class="n">dbprint_prefix</span><span class="o">=</span><span class="kc">None</span>


<span class="c1"># Copy of Python 3.2 reprlib's recursive_repr but allowing extra arguments</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">get_ident</span>
    <span class="k">def</span> <span class="nf">recursive_repr</span><span class="p">(</span><span class="n">fillvalue</span><span class="o">=</span><span class="s1">'...'</span><span class="p">):</span>
        <span class="s1">'Decorator to make a repr function return fillvalue for a recursive call'</span>

        <span class="k">def</span> <span class="nf">decorating_function</span><span class="p">(</span><span class="n">user_function</span><span class="p">):</span>
            <span class="n">repr_running</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">get_ident</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">repr_running</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">fillvalue</span>
                <span class="n">repr_running</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">user_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">repr_running</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">return</span> <span class="n">wrapper</span>

        <span class="k">return</span> <span class="n">decorating_function</span>
<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="recursive_repr"><a class="viewcode-back" href="../../reference.html#param.__init__.recursive_repr">[docs]</a>    <span class="k">def</span> <span class="nf">recursive_repr</span><span class="p">(</span><span class="n">fillvalue</span><span class="o">=</span><span class="s1">'...'</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">decorating_function</span><span class="p">(</span><span class="n">user_function</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">user_function</span>
        <span class="k">return</span> <span class="n">decorating_function</span></div>


<div class="viewcode-block" id="Parameterized"><a class="viewcode-back" href="../../reference.html#param.__init__.Parameterized">[docs]</a><span class="nd">@add_metaclass</span><span class="p">(</span><span class="n">ParameterizedMetaclass</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Parameterized</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Base class for named objects that support Parameters and message</span>
<span class="sd">    formatting.</span>

<span class="sd">    Automatic object naming: Every Parameterized instance has a name</span>
<span class="sd">    parameter.  If the user doesn't designate a name=&lt;str&gt; argument</span>
<span class="sd">    when constructing the object, the object will be given a name</span>
<span class="sd">    consisting of its class name followed by a unique 5-digit number.</span>

<span class="sd">    Automatic parameter setting: The Parameterized __init__ method</span>
<span class="sd">    will automatically read the list of keyword parameters.  If any</span>
<span class="sd">    keyword matches the name of a Parameter (see Parameter class)</span>
<span class="sd">    defined in the object's class or any of its superclasses, that</span>
<span class="sd">    parameter in the instance will get the value given as a keyword</span>
<span class="sd">    argument.  For example:</span>

<span class="sd">      class Foo(Parameterized):</span>
<span class="sd">         xx = Parameter(default=1)</span>

<span class="sd">      foo = Foo(xx=20)</span>

<span class="sd">    in this case foo.xx gets the value 20.</span>

<span class="sd">    When initializing a Parameterized instance ('foo' in the example</span>
<span class="sd">    above), the values of parameters can be supplied as keyword</span>
<span class="sd">    arguments to the constructor (using parametername=parametervalue);</span>
<span class="sd">    these values will override the class default values for this one</span>
<span class="sd">    instance.</span>

<span class="sd">    If no 'name' parameter is supplied, self.name defaults to the</span>
<span class="sd">    object's class name with a unique number appended to it.</span>

<span class="sd">    Message formatting: Each Parameterized instance has several</span>
<span class="sd">    methods for optionally printing output. This functionality is</span>
<span class="sd">    based on the standard Python 'logging' module; using the methods</span>
<span class="sd">    provided here, wraps calls to the 'logging' module's root logger</span>
<span class="sd">    and prepends each message with information about the instance</span>
<span class="sd">    from which the call was made. For more information on how to set</span>
<span class="sd">    the global logging level and change the default message prefix,</span>
<span class="sd">    see documentation for the 'logging' module.</span>
<span class="sd">    """</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">        String identifier for this object."""</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">object_count</span>

        <span class="c1"># Flag that can be tested to see if e.g. constant Parameters</span>
        <span class="c1"># can still be set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters_state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"BATCH_WATCH"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># If true, Event and watcher objects are queued.</span>
            <span class="s2">"TRIGGER"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">"events"</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># Queue of batched events</span>
            <span class="s2">"watchers"</span><span class="p">:</span> <span class="p">[]</span> <span class="c1"># Queue of batched watchers</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instance__params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param_watchers</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_generate_name</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_setup_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="n">object_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># add watched dependencies</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">classlist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">queued</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_depends</span><span class="p">[</span><span class="s1">'watch'</span><span class="p">]:</span>
                <span class="c1"># TODO: should improve this - will happen for every</span>
                <span class="c1"># instantiation of Parameterized with watched deps. Will</span>
                <span class="c1"># probably store expanded deps on class - see metaclass</span>
                <span class="c1"># 'dependers'.</span>
                <span class="n">grouped</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">params_depended_on</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">grouped</span><span class="p">[(</span><span class="nb">id</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">inst</span><span class="p">),</span><span class="nb">id</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">cls</span><span class="p">),</span><span class="n">dep</span><span class="o">.</span><span class="n">what</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="c1"># TODO: can't remember why not just pass m (rather than _m_caller) here</span>
                    <span class="n">gdep</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Need to grab representative dep from this group</span>
                    <span class="p">(</span><span class="n">gdep</span><span class="o">.</span><span class="n">inst</span> <span class="ow">or</span> <span class="n">gdep</span><span class="o">.</span><span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span><span class="n">_m_caller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">group</span><span class="p">],</span> <span class="n">gdep</span><span class="o">.</span><span class="n">what</span><span class="p">,</span> <span class="n">queued</span><span class="o">=</span><span class="n">queued</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># 'Special' methods</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Save the object's state: return a dictionary that is a shallow</span>
<span class="sd">        copy of the object's __dict__ and that also includes the</span>
<span class="sd">        object's __slots__ (if it has any).</span>
<span class="sd">        """</span>
        <span class="c1"># remind me, why is it a copy? why not just state.update(self.__dict__)?</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">get_occupied_slots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">state</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">slot</span><span class="p">)</span>

        <span class="c1"># Note that Parameterized object pickling assumes that</span>
        <span class="c1"># attributes to be saved are only in __dict__ or __slots__</span>
        <span class="c1"># (the standard Python places to store attributes, so that's a</span>
        <span class="c1"># reasonable assumption). (Additionally, class attributes that</span>
        <span class="c1"># are Parameters are also handled, even when they haven't been</span>
        <span class="c1"># instantiated - see PickleableClassAttributes.)</span>

        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Restore objects from the state dictionary to this object.</span>

<span class="sd">        During this process the object is considered uninitialized.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized</span><span class="o">=</span><span class="kc">False</span>

        <span class="c1"># When making a copy the internal watchers have to be</span>
        <span class="c1"># recreated and point to the new instance</span>
        <span class="k">if</span> <span class="s1">'_param_watchers'</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="n">param_watchers</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s1">'_param_watchers'</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">param_watchers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">watchers</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">new_watchers</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">watcher</span> <span class="ow">in</span> <span class="n">watchers</span><span class="p">:</span>
                        <span class="n">watcher_args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">watcher</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">watcher</span><span class="o">.</span><span class="n">inst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">watcher_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
                        <span class="n">fn</span> <span class="o">=</span> <span class="n">watcher</span><span class="o">.</span><span class="n">fn</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s1">'_watcher_name'</span><span class="p">):</span>
                            <span class="n">watcher_args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">_m_caller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">_watcher_name</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">get_method_owner</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="ow">is</span> <span class="n">watcher</span><span class="o">.</span><span class="n">inst</span><span class="p">:</span>
                            <span class="n">watcher_args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                        <span class="n">new_watchers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Watcher</span><span class="p">(</span><span class="o">*</span><span class="n">watcher_args</span><span class="p">))</span>
                    <span class="n">param_watchers</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_watchers</span>

        <span class="k">if</span> <span class="s1">'_instance__params'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="s1">'_instance__params'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s1">'_param_watchers'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="s1">'_param_watchers'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'param'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized</span><span class="o">=</span><span class="kc">True</span>

    <span class="nd">@recursive_repr</span><span class="p">()</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Provide a nearly valid Python representation that could be used to recreate</span>
<span class="sd">        the item with its parameters, if executed in the appropriate environment.</span>

<span class="sd">        Returns 'classname(parameter1=x,parameter2=y,...)', listing</span>
<span class="sd">        all the parameters of this object.</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_param_values</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span> <span class="c1"># Handle recursion in parameter depth</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">"("</span> <span class="o">+</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="o">+</span> <span class="s2">")"</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Return a short representation of the name and class of this object."""</span>
        <span class="k">return</span> <span class="s2">"&lt;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&gt;"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">script_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">imports</span><span class="o">=</span><span class="p">[],</span><span class="n">prefix</span><span class="o">=</span><span class="s2">"    "</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Variant of __repr__ designed for generating a runnable script.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qualify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">separator</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="nd">@recursive_repr</span><span class="p">()</span>
    <span class="c1"># CEBALERT: not yet properly documented</span>
    <span class="k">def</span> <span class="nf">pprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imports</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">" "</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=</span><span class="s1">'&lt;?&gt;'</span><span class="p">,</span>
               <span class="n">qualify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">""</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        (Experimental) Pretty printed representation that may be</span>
<span class="sd">        evaluated with eval. See pprint() function for more details.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">imports</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">imports</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># CEBALERT: imports should just be a set rather than a list;</span>
        <span class="c1"># change in next release?</span>
        <span class="n">imports</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">imports</span><span class="p">))</span>
        <span class="c1"># Generate import statement</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
        <span class="n">imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"import </span><span class="si">%s</span><span class="s2">"</span><span class="o">%</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"import </span><span class="si">%s</span><span class="s2">"</span><span class="o">%</span><span class="n">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">changed_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_param_values</span><span class="p">(</span><span class="n">onlychanged</span><span class="o">=</span><span class="n">script_repr_suppress_defaults</span><span class="p">))</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_param_values</span><span class="p">())</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargspec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'self'</span> <span class="k">else</span> <span class="n">spec</span><span class="o">.</span><span class="n">args</span>

        <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">posargs</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">defaults</span><span class="p">)]</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">defaults</span><span class="p">):],</span> <span class="n">spec</span><span class="o">.</span><span class="n">defaults</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">posargs</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">args</span><span class="p">,</span> <span class="p">[]</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">'existing'</span><span class="p">)</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">changed_params</span><span class="p">),</span> <span class="c1"># alphanumeric tie-breaker</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="s1">'inf'</span><span class="p">)</span>  <span class="c1"># No precedence is lowest possible precendence</span>
                           <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">precedence</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span>
                           <span class="n">parameters</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">precedence</span><span class="p">))</span>

        <span class="n">arglist</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">processed</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">args</span> <span class="o">+</span> <span class="n">ordering</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">processed</span><span class="p">:</span> <span class="k">continue</span>

            <span class="c1"># Suppresses automatically generated names.</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">'name'</span> <span class="ow">and</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'^'</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">'[0-9]+$'</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">])):</span>
                <span class="k">continue</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">pprint</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">imports</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="o">=</span><span class="p">[],</span>
                           <span class="n">unknown_value</span><span class="o">=</span><span class="n">unknown_value</span><span class="p">,</span>
                           <span class="n">qualify</span><span class="o">=</span><span class="n">qualify</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">unknown_value</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: unknown value of </span><span class="si">%r</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">unknown_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># i.e. suppress repr</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">unknown_value</span>

            <span class="c1"># Explicit kwarg (unchanged, known value)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span> <span class="k">continue</span>

            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">posargs</span><span class="p">:</span>
                <span class="c1"># value will be unknown_value unless k is a parameter</span>
                <span class="n">arglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">keywords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="c1"># Explicit modified keywords or parameters in</span>
                <span class="c1"># precendence order (if **kwargs present)</span>
                <span class="n">keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

            <span class="n">processed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="n">qualifier</span> <span class="o">=</span> <span class="n">mod</span> <span class="o">+</span> <span class="s1">'.'</span>  <span class="k">if</span> <span class="n">qualify</span> <span class="k">else</span> <span class="s1">''</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="n">arglist</span> <span class="o">+</span> <span class="n">keywords</span> <span class="o">+</span> <span class="p">([</span><span class="s1">'**</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="n">spec</span><span class="o">.</span><span class="n">varargs</span><span class="p">]</span> <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">varargs</span> <span class="k">else</span> <span class="p">[])</span>
        <span class="k">return</span> <span class="n">qualifier</span> <span class="o">+</span> <span class="s1">'</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>  <span class="p">(</span><span class="s1">','</span><span class="o">+</span><span class="n">separator</span><span class="o">+</span><span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arguments</span><span class="p">))</span>


    <span class="c1"># CEBALERT: note there's no state_push method on the class, so</span>
    <span class="c1"># dynamic parameters set on a class can't have state saved. This</span>
    <span class="c1"># is because, to do this, state_push() would need to be a</span>
    <span class="c1"># @bothmethod, but that complicates inheritance in cases where we</span>
    <span class="c1"># already have a state_push() method. I need to decide what to do</span>
    <span class="c1"># about that. (isinstance(g,Parameterized) below is used to exclude classes.)</span>

    <span class="k">def</span> <span class="nf">state_push</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Save this instance's state.</span>

<span class="sd">        For Parameterized instances, this includes the state of</span>
<span class="sd">        dynamically generated values.</span>

<span class="sd">        Subclasses that maintain short-term state should additionally</span>
<span class="sd">        save and restore that state using state_push() and</span>
<span class="sd">        state_pop().</span>

<span class="sd">        Generally, this method is used by operations that need to test</span>
<span class="sd">        something without permanently altering the objects' state.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">pname</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">'existing'</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_value_generator</span><span class="p">(</span><span class="n">pname</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="s1">'_Dynamic_last'</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">_saved_Dynamic_last</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">_Dynamic_last</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">_saved_Dynamic_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">_Dynamic_time</span><span class="p">)</span>
                <span class="c1"># CB: not storing the time_fn: assuming that doesn't</span>
                <span class="c1"># change.</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="s1">'state_push'</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">Parameterized</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">state_push</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">state_pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Restore the most recently saved state.</span>

<span class="sd">        See state_push() for more details.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">pname</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">'existing'</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_value_generator</span><span class="p">(</span><span class="n">pname</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="s1">'_Dynamic_last'</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">_Dynamic_last</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">_saved_Dynamic_last</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">g</span><span class="o">.</span><span class="n">_Dynamic_time</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">_saved_Dynamic_time</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="s1">'state_pop'</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">Parameterized</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">state_pop</span><span class="p">()</span>


    <span class="c1"># API to be accessed via param namespace</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">_add_parameter</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span><span class="n">param_obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_add_parameter</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span><span class="n">param_obj</span><span class="p">)</span>

    <span class="nd">@bothmethod</span>
    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">parameter_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="n">parameter_name</span><span class="o">=</span><span class="n">parameter_name</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">set_default</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">param_name</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">set_default</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">print_param_defaults</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">print_param_defaults</span><span class="p">()</span>

    <span class="nd">@bothmethod</span>
    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">set_param</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@bothmethod</span>
    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">set_dynamic_time_fn</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span><span class="n">time_fn</span><span class="p">,</span><span class="n">sublistattr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">set_dynamic_time_fn</span><span class="p">(</span><span class="n">time_fn</span><span class="p">,</span><span class="n">sublistattr</span><span class="o">=</span><span class="n">sublistattr</span><span class="p">)</span>

    <span class="nd">@bothmethod</span>
    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">get_param_values</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span><span class="n">onlychanged</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_param_values</span><span class="p">(</span><span class="n">onlychanged</span><span class="o">=</span><span class="n">onlychanged</span><span class="p">)</span>

    <span class="nd">@bothmethod</span>
    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">force_new_dynamic_value</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="n">name</span><span class="p">):</span> <span class="c1"># pylint: disable-msg=E0213</span>
        <span class="k">return</span> <span class="n">cls_or_slf</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">force_new_dynamic_value</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@bothmethod</span>
    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">get_value_generator</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="n">name</span><span class="p">):</span> <span class="c1"># pylint: disable-msg=E0213</span>
        <span class="k">return</span> <span class="n">cls_or_slf</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_value_generator</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@bothmethod</span>
    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">inspect_value</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="n">name</span><span class="p">):</span> <span class="c1"># pylint: disable-msg=E0213</span>
        <span class="k">return</span> <span class="n">cls_or_slf</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">inspect_value</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">_set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_set_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">__db_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">__db_print</span><span class="p">(</span><span class="n">level</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">verbose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">print_param_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">print_param_values</span><span class="p">()</span>

    <span class="nd">@Parameters</span><span class="o">.</span><span class="n">deprecate</span>
    <span class="k">def</span> <span class="nf">defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">defaults</span><span class="p">()</span></div>



<div class="viewcode-block" id="print_all_param_defaults"><a class="viewcode-back" href="../../reference.html#param.__init__.print_all_param_defaults">[docs]</a><span class="k">def</span> <span class="nf">print_all_param_defaults</span><span class="p">():</span>
    <span class="sd">"""Print the default values for all imported Parameters."""</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"_______________________________________________________________________________"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"                           Parameter Default Values"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="n">descendents</span><span class="p">(</span><span class="n">Parameterized</span><span class="p">)</span>
    <span class="n">classes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="n">c</span><span class="o">.</span><span class="n">print_param_defaults</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"_______________________________________________________________________________"</span><span class="p">)</span></div>



<span class="c1"># Note that with Python 2.6, a fn's **args no longer has to be a</span>
<span class="c1"># dictionary. This might allow us to use a decorator to simplify using</span>
<span class="c1"># ParamOverrides (if that does indeed make them simpler to use).</span>
<span class="c1"># http://docs.python.org/whatsnew/2.6.html</span>
<div class="viewcode-block" id="ParamOverrides"><a class="viewcode-back" href="../../reference.html#param.__init__.ParamOverrides">[docs]</a><span class="k">class</span> <span class="nc">ParamOverrides</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A dictionary that returns the attribute of a specified object if</span>
<span class="sd">    that attribute is not present in itself.</span>

<span class="sd">    Used to override the parameters of an object.</span>
<span class="sd">    """</span>

    <span class="c1"># NOTE: Attribute names of this object block parameters of the</span>
    <span class="c1"># same name, so all attributes of this object should have names</span>
    <span class="c1"># starting with an underscore (_).</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overridden</span><span class="p">,</span><span class="n">dict_</span><span class="p">,</span><span class="n">allow_extra_keywords</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">"""</span>

<span class="sd">        If allow_extra_keywords is False, then all keys in the</span>
<span class="sd">        supplied dict_ must match parameter names on the overridden</span>
<span class="sd">        object (otherwise a warning will be printed).</span>

<span class="sd">        If allow_extra_keywords is True, then any items in the</span>
<span class="sd">        supplied dict_ that are not also parameters of the overridden</span>
<span class="sd">        object will be available via the extra_keywords() method.</span>
<span class="sd">        """</span>
        <span class="c1"># we'd like __init__ to be fast because it's going to be</span>
        <span class="c1"># called a lot. What's the fastest way to move the existing</span>
        <span class="c1"># params dictionary into this one? Would</span>
        <span class="c1">#  def __init__(self,overridden,**kw):</span>
        <span class="c1">#      ...</span>
        <span class="c1">#      dict.__init__(self,**kw)</span>
        <span class="c1"># be faster/easier to use?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overridden</span> <span class="o">=</span> <span class="n">overridden</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dict_</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">allow_extra_keywords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extra_keywords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_extra_keywords</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_params</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span>

<div class="viewcode-block" id="ParamOverrides.extra_keywords"><a class="viewcode-back" href="../../reference.html#param.__init__.ParamOverrides.extra_keywords">[docs]</a>    <span class="k">def</span> <span class="nf">extra_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return a dictionary containing items from the originally</span>
<span class="sd">        supplied dict_ whose names are not parameters of the</span>
<span class="sd">        overridden object.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_keywords</span></div>

<div class="viewcode-block" id="ParamOverrides.param_keywords"><a class="viewcode-back" href="../../reference.html#param.__init__.ParamOverrides.param_keywords">[docs]</a>    <span class="k">def</span> <span class="nf">param_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return a dictionary containing items from the originally</span>
<span class="sd">        supplied dict_ whose names are parameters of the</span>
<span class="sd">        overridden object (i.e. not extra keywords/parameters).</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra_keywords</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="fm">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="c1"># Return 'name' from the overridden object</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_overridden</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># As dict.__repr__, but indicate the overridden object</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">+</span><span class="s2">" overriding params from </span><span class="si">%s</span><span class="s2">"</span><span class="o">%</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_overridden</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="c1"># Provide 'dot' access to entries in the dictionary.</span>
        <span class="c1"># (This __getattr__ method is called only if 'name' isn't an</span>
        <span class="c1"># attribute of self.)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="c1"># Attributes whose name starts with _ are set on self (as</span>
        <span class="c1"># normal), but all other attributes are inserted into the</span>
        <span class="c1"># dictionary.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'_'</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

<div class="viewcode-block" id="ParamOverrides.get"><a class="viewcode-back" href="../../reference.html#param.__init__.ParamOverrides.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overridden</span><span class="o">.</span><span class="n">param</span>

    <span class="k">def</span> <span class="nf">_check_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Print a warning if params contains something that is not a</span>
<span class="sd">        Parameter of the overridden object.</span>
<span class="sd">        """</span>
        <span class="n">overridden_object_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_overridden</span><span class="o">.</span><span class="n">param</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">overridden_object_params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"'</span><span class="si">%s</span><span class="s2">' will be ignored (not a Parameter)."</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_extra_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return any items in params that are not also</span>
<span class="sd">        parameters of the overridden object.</span>
<span class="sd">        """</span>
        <span class="n">extra_keywords</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">overridden_object_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_overridden</span><span class="o">.</span><span class="n">param</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">overridden_object_params</span><span class="p">:</span>
                <span class="n">extra_keywords</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="n">val</span>
                <span class="c1"># CEBALERT: should we remove name from params</span>
                <span class="c1"># (i.e. del params[name]) so that it's only available</span>
                <span class="c1"># via extra_keywords()?</span>
        <span class="k">return</span> <span class="n">extra_keywords</span></div>


<span class="c1"># Helper function required by ParameterizedFunction.__reduce__</span>
<span class="k">def</span> <span class="nf">_new_parameterized</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Parameterized</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>


<div class="viewcode-block" id="ParameterizedFunction"><a class="viewcode-back" href="../../reference.html#param.__init__.ParameterizedFunction">[docs]</a><span class="k">class</span> <span class="nc">ParameterizedFunction</span><span class="p">(</span><span class="n">Parameterized</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Acts like a Python function, but with arguments that are Parameters.</span>

<span class="sd">    Implemented as a subclass of Parameterized that, when instantiated,</span>
<span class="sd">    automatically invokes __call__ and returns the result, instead of</span>
<span class="sd">    returning an instance of the class.</span>

<span class="sd">    To obtain an instance of this class, call instance().</span>
<span class="sd">    """</span>
    <span class="n">__abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># CEBALERT: shouldn't this have come from a parent class</span>
    <span class="c1"># somewhere?</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s2">"()"</span>

<div class="viewcode-block" id="ParameterizedFunction.instance"><a class="viewcode-back" href="../../reference.html#param.__init__.ParameterizedFunction.instance">[docs]</a>    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">instance</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return an instance of this class, copying parameters from any</span>
<span class="sd">        existing instance provided.</span>
<span class="sd">        """</span>

        <span class="k">if</span> <span class="nb">isinstance</span> <span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span><span class="n">ParameterizedMetaclass</span><span class="p">):</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_or_cls</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">params</span>
            <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_param_values</span><span class="p">())</span>
            <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="vm">__class__</span>

        <span class="n">inst</span><span class="o">=</span><span class="n">Parameterized</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">Parameterized</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">'name'</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>  <span class="n">inst</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>                 <span class="n">inst</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">inst</span></div>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">class_</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="c1"># Create and __call__() an instance of this class.</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">class_</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_set_name</span><span class="p">(</span><span class="n">class_</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inst</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Subclasses must implement __call__."</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Control reconstruction (during unpickling and copying):</span>
        <span class="c1"># ensure that ParameterizedFunction.__new__ is skipped</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">ParameterizedFunction</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># CB: here it's necessary to use a function defined at the</span>
        <span class="c1"># module level rather than Parameterized.__new__ directly</span>
        <span class="c1"># because otherwise pickle will find .__new__'s module to be</span>
        <span class="c1"># __main__. Pretty obscure aspect of pickle.py, or a bug?</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">_new_parameterized</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,),</span><span class="n">state</span><span class="p">)</span>

<div class="viewcode-block" id="ParameterizedFunction.script_repr"><a class="viewcode-back" href="../../reference.html#param.__init__.ParameterizedFunction.script_repr">[docs]</a>    <span class="k">def</span> <span class="nf">script_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">imports</span><span class="o">=</span><span class="p">[],</span><span class="n">prefix</span><span class="o">=</span><span class="s2">"    "</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Same as Parameterized.script_repr, except that X.classname(Y</span>
<span class="sd">        is replaced with X.classname.instance(Y</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">unknown_value</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span><span class="n">qualify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">separator</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></div>


<div class="viewcode-block" id="ParameterizedFunction.pprint"><a class="viewcode-back" href="../../reference.html#param.__init__.ParameterizedFunction.pprint">[docs]</a>    <span class="k">def</span> <span class="nf">pprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imports</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">    "</span><span class="p">,</span><span class="n">unknown_value</span><span class="o">=</span><span class="s1">'&lt;?&gt;'</span><span class="p">,</span>
               <span class="n">qualify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">""</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Same as Parameterized.pprint, except that X.classname(Y</span>
<span class="sd">        is replaced with X.classname.instance(Y</span>
<span class="sd">        """</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">Parameterized</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span>
                                 <span class="n">unknown_value</span><span class="o">=</span><span class="n">unknown_value</span><span class="p">,</span>
                                 <span class="n">qualify</span><span class="o">=</span><span class="n">qualify</span><span class="p">,</span><span class="n">separator</span><span class="o">=</span><span class="n">separator</span><span class="p">)</span>
        <span class="n">classname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">".</span><span class="si">%s</span><span class="s2">("</span><span class="o">%</span><span class="n">classname</span><span class="p">,</span><span class="s2">".</span><span class="si">%s</span><span class="s2">.instance("</span><span class="o">%</span><span class="n">classname</span><span class="p">)</span></div></div>



<div class="viewcode-block" id="default_label_formatter"><a class="viewcode-back" href="../../reference.html#param.__init__.default_label_formatter">[docs]</a><span class="k">class</span> <span class="nc">default_label_formatter</span><span class="p">(</span><span class="n">ParameterizedFunction</span><span class="p">):</span>
    <span class="s2">"Default formatter to turn parameter names into appropriate widget labels."</span>

    <span class="n">capitalize</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">        Whether or not the label should be capitalized."""</span><span class="p">)</span>

    <span class="n">replace_underscores</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">        Whether or not underscores should be replaced with spaces."""</span><span class="p">)</span>

    <span class="n">overrides</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">{},</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">        Allows custom labels to be specified for specific parameter</span>
<span class="s2">        names using a dictionary where key is the parameter name and the</span>
<span class="s2">        value is the desired label."""</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">overrides</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">overrides</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_underscores</span><span class="p">:</span>
            <span class="n">pname</span> <span class="o">=</span> <span class="n">pname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'_'</span><span class="p">,</span><span class="s1">' '</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">capitalize</span><span class="p">:</span>
            <span class="n">pname</span> <span class="o">=</span> <span class="n">pname</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">pname</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">pname</span></div>


<span class="n">label_formatter</span> <span class="o">=</span> <span class="n">default_label_formatter</span>


<span class="c1"># CBENHANCEMENT: should be able to remove overridable_property when we</span>
<span class="c1"># switch to Python 2.6:</span>
<span class="c1"># "Properties now have three attributes, getter, setter and deleter,</span>
<span class="c1"># that are decorators providing useful shortcuts for adding a getter,</span>
<span class="c1"># setter or deleter function to an existing property."</span>
<span class="c1"># http://docs.python.org/whatsnew/2.6.html</span>

<span class="c1"># Renamed &amp; documented version of OProperty from</span>
<span class="c1"># infinitesque.net/articles/2005/enhancing%20Python's%20property.xhtml</span>
<div class="viewcode-block" id="overridable_property"><a class="viewcode-back" href="../../reference.html#param.__init__.overridable_property">[docs]</a><span class="k">class</span> <span class="nc">overridable_property</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    The same as Python's "property" attribute, but allows the accessor</span>
<span class="sd">    methods to be overridden in subclasses.</span>
<span class="sd">    """</span>
    <span class="c1"># Delays looking up the accessors until they're needed, rather</span>
    <span class="c1"># than finding them when the class is first created.</span>

    <span class="c1"># Based on the emulation of PyProperty_Type() in Objects/descrobject.c</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fdel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fget</span> <span class="o">=</span> <span class="n">fget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fset</span> <span class="o">=</span> <span class="n">fset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fdel</span> <span class="o">=</span> <span class="n">fdel</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">objtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">"unreadable attribute"</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'&lt;lambda&gt;'</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)()</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">"can't set attribute"</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fset</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'&lt;lambda&gt;'</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fset</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fset</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fset</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">"can't delete attribute"</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdel</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'&lt;lambda&gt;'</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdel</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fdel</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdel</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)()</span></div>
</pre></div>
</div>
<div class="prev-next-bottom">
</div>
</main>
</div>
</div>
<script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-154795830-6', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>
<footer class="footer mt-5 mt-md-0">
<div class="container">
<div class="footer-item">
<p class="copyright">
    Â© Copyright 2003-2021 HoloViz developers.<br/>
</p>
</div>
<div class="footer-item">
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
</p>
</div>
</div>
</footer>
</body>
</html>